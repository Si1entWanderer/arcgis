{"version":3,"sources":["../node_modules/@arcgis/core/layers/support/ExportImageParameters.js","../node_modules/@arcgis/core/layers/MapImageLayer.js"],"names":["l","visible","definitionExpression","labelingInfo","labelsVisible","opacity","minScale","maxScale","renderer","source","n","e","scale","this","layer","hasDynamicLayers","visibleSublayers","map","toExportImageJSON","length","JSON","stringify","o","serviceSublayers","_get","_set","handles","remove","add","allSublayers","on","notifyChange","propertyName","id","join","filter","reduce","r","commitProperty","sublayers","forEach","s","t","i","a","unshift","some","dpi","format","imageFormat","transparent","imageTransparency","gdbVersion","dynamicLayers","layers","layerDefs","readOnly","prototype","type","Number","U","alwaysRefetch","imageMaxHeight","imageMaxWidth","isReference","operationalLayerType","sourceJSON","url","signal","addResolvingPromise","loadFromPortal","supportedTypes","catch","then","_fetchService","Promise","resolve","supportedImageFormatTypes","indexOf","loaded","slice","reverse","flatten","toArray","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","h","origin","createSublayersForOrigin","T","p","writeSublayerStructure","write","push","originOf","Object","keys","visibleLayers","pixelRatio","version","clone","shiftCentralMeridian","R","g","extent","width","toJSON","destroy","rotation","spatialReference","wkid","m","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","responseType","query","parsedUrl","createExportImageParameters","f","_ts","Date","now","timestamp","customParameters","token","apiKey","path","reject","data","error","returnUpdates","fullExtent","fromJSON","read","ssl","replace","S","P","M","I","E","b","j","O","L","x","w","v","u","json","origins","service","Boolean","enabled","overridePolicy","ignoreOrigin","d","J","c","value","N","q","y"],"mappings":"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","file":"static/js/37.73272f9a.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{isExportDynamic as o}from\"./sublayerUtils.js\";const l={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let n=class extends(s(r)){constructor(e){super(e),this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&o(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(l[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,r)=>(e[r.id]=r.definitionExpression,e)),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,a=0===r.minScale||t<=r.minScale,o=0===r.maxScale||t>=r.maxScale;r.visible&&(i||a&&o)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([t({readOnly:!0})],n.prototype,\"dynamicLayers\",null),e([t({readOnly:!0})],n.prototype,\"hasDynamicLayers\",null),e([t()],n.prototype,\"layer\",null),e([t({readOnly:!0})],n.prototype,\"layers\",null),e([t({readOnly:!0})],n.prototype,\"layerDefs\",null),e([t({type:Number})],n.prototype,\"scale\",void 0),e([t(a)],n.prototype,\"timeExtent\",void 0),e([t({readOnly:!0})],n.prototype,\"version\",null),e([t({readOnly:!0})],n.prototype,\"visibleSublayers\",null),n=e([i(\"esri.layers.mixins.ExportImageParameters\")],n);export{n as ExportImageParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../TimeExtent.js\";import i from\"../core/Error.js\";import{HandleOwnerMixin as o}from\"../core/HandleOwner.js\";import{loadAll as s}from\"../core/loadAll.js\";import{isSome as a}from\"../core/maybe.js\";import{MultiOriginJSONMixin as p}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as n,isAbortError as l}from\"../core/promiseUtils.js\";import{property as m}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import{Integer as c}from\"../core/accessorSupport/ensureType.js\";import\"../core/Logger.js\";import{reader as u}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as y}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import{nameToId as h}from\"../core/accessorSupport/PropertyOrigin.js\";import f from\"../geometry/Extent.js\";import{getScale as g}from\"../geometry/support/scaleUtils.js\";import v from\"./Layer.js\";import{APIKeyMixin as x}from\"./mixins/APIKeyMixin.js\";import{ArcGISMapService as b}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as j}from\"./mixins/ArcGISService.js\";import{BlendLayer as S}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as w}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as O}from\"./mixins/OperationalLayer.js\";import{PortalLayer as L}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as I}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as M}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as E}from\"./mixins/SublayersOwner.js\";import{TemporalLayer as P}from\"./mixins/TemporalLayer.js\";import{url as N}from\"./support/commonProperties.js\";import{ExportImageParameters as R}from\"./support/ExportImageParameters.js\";import J from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as T}from\"./support/sublayerUtils.js\";let U=class extends(S(P(M(I(E(b(j(O(L(p(x(w(o(v)))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=a(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(n).then((()=>this._fetchService(r)))),Promise.resolve(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf(\"PNG32\")>-1?\"png32\":\"png24\"}writeSublayers(e,r,t,i){if(!this.loaded||!e)return;const o=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let s=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=h(i.origin);if(3===e){const e=this.createSublayersForOrigin(\"service\").sublayers;s=T(o,e,2)}else if(e>3){const e=this.createSublayersForOrigin(\"portal-item\");s=T(o,e.sublayers,h(e.origin))}}const a=[],p={writeSublayerStructure:s,...i};let n=s;o.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=o.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,i){const o=i&&i.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const s=new R({layer:this,scale:g({extent:e,width:r})*o}),a=s.toJSON();s.destroy();const p=!i||!i.rotation||this.version<10.3?{}:{rotation:-i.rotation},n=e&&e.spatialReference,l=n.wkid||JSON.stringify(n.toJSON());a.dpi*=o;const m={};if(null!=i&&i.timeExtent){const{start:e,end:r}=i.timeExtent.toJSON();m.time=e&&r&&e===r?\"\"+e:`${null==e?\"null\":e},${null==r?\"null\":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(m.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:l,imageSR:l,size:r+\",\"+t,...a,...p,...m}}async fetchImage(e,t,o,s){var a,p;const n={responseType:\"image\",signal:null!=(a=null==s?void 0:s.signal)?a:null,query:{...this.parsedUrl.query,...this.createExportImageParameters(e,t,o,s),f:\"image\",_ts:this.alwaysRefetch?Date.now():null!=(p=null==s?void 0:s.timestamp)?p:null,...this.customParameters,token:this.apiKey}},m=this.parsedUrl.path+\"/export\";if(null!=n.query.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return Promise.reject(new i(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:n.query}));return r(m,n).then((e=>e.data)).catch((e=>{if(l(e))throw e;throw new i(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${m}`,{error:e})}))}async fetchRecomputedExtents(e={}){const i={...e,query:{returnUpdates:!0,f:\"json\"}},{data:o}=await r(this.url,i),{extent:s,fullExtent:a,timeExtent:p}=o,n=s||a;return{fullExtent:n&&f.fromJSON(n),timeExtent:p&&t.fromJSON({start:p[0],end:p[1]})}}loadAll(){return s(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:t,ssl:i}=await r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});i&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=t,this.read(t,{origin:\"service\",url:this.parsedUrl})}};e([m()],U.prototype,\"alwaysRefetch\",void 0),e([m()],U.prototype,\"dpi\",void 0),e([m()],U.prototype,\"gdbVersion\",void 0),e([m()],U.prototype,\"imageFormat\",void 0),e([u(\"imageFormat\",[\"supportedImageFormatTypes\"])],U.prototype,\"readImageFormat\",null),e([m({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],U.prototype,\"imageMaxHeight\",void 0),e([m({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],U.prototype,\"imageMaxWidth\",void 0),e([m()],U.prototype,\"imageTransparency\",void 0),e([m({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],U.prototype,\"isReference\",void 0),e([m({json:{read:!1,write:!1}})],U.prototype,\"labelsVisible\",void 0),e([m({type:[\"ArcGISMapServiceLayer\"]})],U.prototype,\"operationalLayerType\",void 0),e([m({json:{read:!1,write:!1}})],U.prototype,\"popupEnabled\",void 0),e([m()],U.prototype,\"sourceJSON\",void 0),e([m({json:{write:{ignoreOrigin:!0}}})],U.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[J]},visibleLayers:{type:[c]}})],U.prototype,\"writeSublayers\",null),e([m({type:[\"show\",\"hide\",\"hide-children\"]})],U.prototype,\"listMode\",void 0),e([m({json:{read:!1},readOnly:!0,value:\"map-image\"})],U.prototype,\"type\",void 0),e([m(N)],U.prototype,\"url\",void 0),U=e([y(\"esri.layers.MapImageLayer\")],U);var q=U;export default q;\n"],"sourceRoot":""}