(this.webpackJsonparcgis=this.webpackJsonparcgis||[]).push([[90],{1175:function(e,t,i){"use strict";i.r(t);var a=i(2),n=i(5),r=i(6),s=i(7),o=i(0),l=i(3),c=i(1),u=(i(17),i(18),i(15),i(10)),d=i(936),h=i(572),b=i(30),v=i(57),O=i(20),_=i(877),p=i(35),g=i(300),j=i(4),m=i(9),f=i(785),y=i(176),w=i(51),L=i(68),k=i(878),z=i(879),M=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e))._unitNormalizer=new z.a,n._handles=new v.a,n._tempStartPosition=Object(m.e)(),n._tempEndPosition=Object(m.e)(),n._tempCornerPosition=Object(m.e)(),n}return Object(n.a)(i,[{key:"initialize",value:function(){var e=this;this._handles.add(Object(p.j)(this.view,"ready",(function(){return e._initialize()}),!0))}},{key:"destroy",value:function(){this._handles=Object(l.e)(this._handles)}},{key:"_initialize",value:function(){var e=this,t=this.view.spatialReference,i=Object(L.g)(t),a=i===L.a?L.d:i;this._sphericalPCPF=a;var n=Object(w.b)(t,a);this._unitNormalizer.spatialReference=n?a:t,this._handles.add(Object(g.d)((function(){return{result:e._computedResult,viewData:e.viewData}}),(function(e){var t=e.result;e.viewData.result=t})))}},{key:"_computedResult",get:function(){var e=this.layer,t=e.startPoint,i=e.endPoint;if(Object(l.i)(t)||Object(l.i)(i))return null;var a=this._euclideanDistances(t,i),n=this._exactGeodesicDistanceAndAngle(t,i,a.horizontal.value);return{directDistance:a.direct,horizontalDistance:a.horizontal,verticalDistance:a.vertical,geodesicDistance:n.distance,geodesicAngle:n.angle}}},{key:"_euclideanDistances",value:function(e,t){var i=this,a=e.clone();a.z=t.z;var n=this._tempStartPosition,r=this._tempEndPosition,s=this._tempCornerPosition,o=this.view.spatialReference,l=this._sphericalPCPF,c=Object(w.b)(o,l)?l:o;Object(w.u)(e,n,c),Object(w.u)(t,r,c),Object(w.u)(a,s,c);var u=Object(j.o)(n,r),d=Object(j.o)(s,r),h=Math.abs(t.z-e.z),b=function(e){return i._unitNormalizer.normalizeDistance(e)},v=b(u),O=b(d),p=b(h);return{direct:new _.a(v,"meters"),horizontal:new _.a(O,"meters"),vertical:new _.a(p,"meters")}}},{key:"_exactGeodesicDistanceAndAngle",value:function(e,t,i){var a=e.spatialReference,n=new y.a({spatialReference:a});n.addPath([e,t]);var r=a.isGeographic&&Object(k.c)(a)?Object(k.a)([n],"meters")[0]:a.isWebMercator?Object(f.geodesicLength)(n,"meters"):void 0,s=r?{distance:r,angle:this._fallbackGeodesicAngle(r,a)}:this._fallbackGeodesicDistance(e,t,i),o=s.distance,l=s.angle;return{distance:new _.a(o,"meters"),angle:new _.a(l,"degrees")}}},{key:"_fallbackGeodesicAngle",value:function(e,t){return e/Object(L.e)(t).metersPerDegree}},{key:"_fallbackGeodesicDistance",value:function(e,t,i){if(Object(w.v)(e,C)){Object(w.v)(t,S);var a=Object(O.g)(C[0]),n=Object(O.g)(C[1]),r=Object(O.g)(S[0]),s=Object(O.g)(S[1]),o=Math.abs(r-a),l=Object(O.b)(Math.sin(n)*Math.sin(s)+Math.cos(n)*Math.cos(s)*Math.cos(o)),c=Object(O.r)(l),u={distance:0};return Object(k.b)(u,[C[0],C[1]],[S[0],S[1]]),{distance:u.distance,angle:c}}var d=e.spatialReference,h=i;return{distance:h,angle:this._fallbackGeodesicAngle(h,d)}}}]),i}(b.a);Object(o.a)([Object(c.b)()],M.prototype,"view",void 0),Object(o.a)([Object(c.b)()],M.prototype,"layer",void 0),Object(o.a)([Object(c.b)()],M.prototype,"viewData",void 0),Object(o.a)([Object(c.b)()],M.prototype,"_computedResult",null),M=Object(o.a)([Object(u.a)("esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController")],M);var C=Object(m.e)(),S=Object(m.e)(),V=i(8),P=i.n(V),E=i(16),D=i(14),x=(i(343),i(937)),A=i(28),G=i(69),R=i(29),T=i(203),q=i(965),U=i(787),H=i(31),W=i(47),Q=i(752),F=i(171),B=i(108),I=i(195),N=i(116),J=i(106),K=i(91),X=i(95),Y=i(24),Z=i(77),$=i(88),ee=i(880),te=i(41),ie=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e,n,r){return Object(a.a)(this,i),t.call(this,e,n,r)}return Object(n.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build();return new $.a(e.rctx,t,Z.a)}},{key:"bindPass",value:function(e,t){Object(J.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("width",e.width),this.program.setUniform1f("outlineSize",e.outlineSize),this.program.setUniform4fv("outlineColor",e.outlineColor),this.program.setUniform1f("stripeLength",e.stripeLength),this.program.setUniform4fv("stripeEvenColor",e.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",e.stripeOddColor)}},{key:"bindDraw",value:function(e){Object(J.d)(this.program,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){return Object(te.g)({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:te.e,colorWrite:te.d})}},{key:"primitiveType",get:function(){return 5}}]),i}(X.a);ie.shader=new K.a(ee.a,(function(){return i.e(202).then(i.bind(null,1158))}));var ae=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments)).polygonOffsetEnabled=!1,e}return i}(Y.a);Object(o.a)([Object(Y.b)()],ae.prototype,"polygonOffsetEnabled",void 0);var ne=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e,se)).techniqueConfig=new ae,n}return Object(n.a)(i,[{key:"getTechniqueConfig",value:function(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}},{key:"dispose",value:function(){}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(){}},{key:"createBufferWriter",value:function(){return new be}},{key:"getGLMaterial",value:function(e){return 0===e.output?new re(e):void 0}}]),i}(N.a),re=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).updateParameters(),n}return Object(n.a)(i,[{key:"updateParameters",value:function(){this._technique=this._techniqueRep.releaseAndAcquire(ie,this._material.getTechniqueConfig(),this._technique)}},{key:"beginSlot",value:function(e){return 3===e}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}}]),i}(I.a),se=Object(D.a)({width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},N.b),oe=Object(B.a)().vec3f("position").vec3f("normal").vec2f("uv0").f32("auxpos1"),le=Object(m.e)(),ce=Object(m.e)(),ue=Object(m.e)(),de=Object(m.e)(),he=Object(m.e)(),be=function(){function e(){Object(a.a)(this,e),this.vertexBufferLayout=oe}return Object(n.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 2*(e.indices.get("position").length/2+1)}},{key:"write",value:function(e,t,i,a){var n=t.vertexAttributes.get("position").data,r=t.vertexAttributes.get("normal").data,s=n.length/3,o=t&&t.indices&&t.indices.get("position");o&&o.length!==2*(s-1)&&console.warn("MeasurementArrowMaterial does not support indices");for(var l=le,c=ce,u=ue,d=de,h=he,b=e.transformation,v=e.invTranspTransformation,O=i.position,_=i.normal,p=i.uv0,g=0,m=0;m<s;++m){var f=3*m;if(Object(j.y)(l,n[f],n[f+1],n[f+2]),m<s-1){var y=3*(m+1);Object(j.y)(c,n[y],n[y+1],n[y+2]),Object(j.y)(h,r[y],r[y+1],r[y+2]),Object(j.t)(h,h),Object(j.l)(u,c,l),Object(j.t)(u,u),Object(j.i)(d,h,u),Object(j.t)(d,d)}var w=Object(j.o)(l,c);b&&v&&(Object(j.s)(l,l,b),Object(j.s)(c,c,b),Object(j.s)(d,d,v));var L=a+2*m,k=L+1;O.setVec(L,l),O.setVec(k,l),_.setVec(L,d),_.setVec(k,d),p.set(L,0,g),p.set(L,1,-1),p.set(k,0,g),p.set(k,1,1),m<s-1&&(g+=w)}for(var z=i.auxpos1,M=0;M<2*s;++M)z.set(a+M,g)}}]),e}(),ve=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e))._parameters=Oe,n._handles=null,n._origin=Object(m.e)(),n._originTransform=Object(H.d)(),n._arrowCenter=Object(m.e)(),n._renderOccluded=4,n._geometry=null,n._stripeLength=1,n._stripesEnabled=!0,n.applyProps(e),n}return Object(n.a)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(e){if(this._stripesEnabled=e,this.attached){var t=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:t})}}},{key:"createExternalResources",value:function(){var e=this,t=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new ne({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:t,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new v.a,this._handles.add(this.view.state.watch("camera",(function(){e.viewChanged()})))}},{key:"destroyExternalResources",value:function(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}},{key:"forEachExternalMaterial",value:function(e){e(this._arrowMaterial)}},{key:"createGeometries",value:function(e){if(!(Object(l.i)(this._geometry)||Object(l.i)(this._geometry.startRenderSpace)||Object(l.i)(this._geometry.endRenderSpace))){var t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}}},{key:"_createArrowGeometry",value:function(e,t,i,a){var n=this.view.renderCoordsHelper,r=[],s=[],o=function(e,t){var a=W.c.get();Object(j.l)(a,e,i),r.push(a),s.push(t)};if("euclidean"===a.type){a.eval(.5,this._arrowCenter);var l=W.c.get();n.worldUpAtPosition(this._arrowCenter,l),o(e,l),o(t,l)}else{a.eval(.5,this._arrowCenter);for(var c=this._parameters.arrowSubdivisions+1&-2,u=0;u<c;++u){var d=u/(c-1),h=W.c.get(),b=W.c.get();a.eval(d,h),n.worldUpAtPosition(h,b),o(h,b)}}return F.a.createPolylineGeometry(r,s)}},{key:"geometryChanged",value:function(){this.recreateGeometry()}},{key:"viewChanged",value:function(){if(this.view.ready&&this.attached&&Object(l.j)(this._geometry)){var e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}]),i}(Q.a),Oe={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},_e=i(50),pe=i(26),ge=i(54),je=i(115),me=i(555),fe=i(344),ye=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e))._handles=new v.a,n._quadMaterial=null,n._outlineMaterial=null,n._maxSize=0,n._position=Object(m.e)(),n._up=Object(m.e)(),n._right=Object(m.e)(),n._renderOccluded=4,n._color=Object(T.c)(1,0,0,1),n._outlineColor=Object(T.c)(0,0,0,1),n._outlineSize=0,n._size=32,n._outlineRenderOccluded=16,n.applyProps(e),n}return Object(n.a)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(ge.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(ge.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,i=e.center,a=e.next;this._maxSize=Math.min(Object(j.o)(i,t),Object(j.o)(i,a))/3,Object(j.t)(this._up,Object(j.l)(this._up,t,i)),Object(j.t)(this._right,Object(j.l)(this._right,a,i)),Object(j.m)(this._position,i),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new me.a(this.quadMaterialParameters),this._outlineMaterial=new fe.a(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=Object(j.h)(W.c.get(),this._up,this._right),i=F.a.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,i);Object(pe.i)(we),Object(pe.t)(we,we,this._position),Object(pe.s)(we,we,[a,a,a]),Object(l.j)(e)&&(e.transformation=we)}},{key:"_quadGeometryData",value:function(e,t){var i=Object(j.h)(W.c.get(),e,t);return new je.a([["position",{size:3,data:[0,0,0].concat(Object(_e.a)(t),Object(_e.a)(e),Object(_e.a)(i)),exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}]),i}(Q.a),we=Object(H.d)(),Le=i(939),ke=i(940),ze=i(464),Me=i(138),Ce=i(242),Se=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e))._params=Object(D.a)({},Pe),n._handles=new v.a,n._segmentVisualElement=null,n._triangleVisualElement=null,n._rightAngleQuad=null,n._projectedGeodesicLine=null,n._geodesicStartHint=null,n._geodesicEndHint=null,n._segmentLabel=null,n._verticalLabel=null,n._horizontalLabel=null,n._startPosition=Object(m.e)(),n._endPosition=Object(m.e)(),n._cornerPosition=Object(m.e)(),n._startPositionAtSeaLevel=Object(m.e)(),n._endPositionAtSeaLevel=Object(m.e)(),n._state=0,n._segmentLabelDisplayedMeasurement=1,n._triangleOrientationOverride=null,n.messages=null,n.viewMode=0,n.visualizedMeasurement=0,n.actualVisualizedMeasurement=1,n.visualElementOrientation=0,n.triangleCollapseRatioThreshold=.03,n}return Object(n.a)(i,[{key:"_geodesicDistanceExceeded",get:function(){var e,t=this.layerView.result;return Object(l.j)(t)&&(null==(e=t.horizontalDistance)?void 0:e.value)>this.layer.geodesicDistanceThreshold}},{key:"ready",get:function(){return 1===this._state}},{key:"visible",get:function(){return this.layerView.visible&&!this.layerView.suspended}},{key:"allowVisualElementsOrientationChange",get:function(){return Object(l.i)(this._triangleOrientationOverride)},set:function(e){Object(l.i)(this._triangleOrientationOverride)!==e&&(Object(l.i)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._getActualVisualElementsOrientation():this._triangleOrientationOverride=null)}},{key:"labels",get:function(){return 2===this.actualVisualizedMeasurement?{direct:this._horizontalLabel,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}},{key:"testData",get:function(){return{labels:this.labels,stripeLength:this._segmentVisualElement.stripeLength}}},{key:"initialize",value:function(){var e=this;this._handles.add(Object(p.j)(this.view,"ready",(function(){return e._initialize()}),!0))}},{key:"_initialize",value:function(){var e=this;switch(this._state){case 1:throw new Error("invalid state");case 2:return}var t=this._params,i={attached:!0,view:this.view};this._segmentVisualElement=new ve(Object(D.a)(Object(D.a)({},i),{},{geometry:null,renderOccluded:4})),this._triangleVisualElement=new U.a(Object(D.a)(Object(D.a)({},i),{},{width:t.triangleLineWidth,color:t.triangleColor,renderOccluded:4})),this._rightAngleQuad=new ye(Object(D.a)(Object(D.a)({},i),{},{color:Ve,renderOccluded:4}));var a=Object(D.a)(Object(D.a)({},i),{},{polygonOffset:!0,stippleIntegerRepeats:!1,renderOccluded:4});this._projectedGeodesicLine=new U.a(Object(D.a)(Object(D.a)({},a),{},{width:t.geodesicProjectionLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:Object(ze.b)(t.guideStippleLengthPixels)})),this._geodesicStartHint=new U.a(Object(D.a)(Object(D.a)({},a),{},{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:Object(ze.b)(t.guideStippleLengthPixels)})),this._geodesicEndHint=new U.a(Object(D.a)(Object(D.a)({},a),{},{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:Object(ze.b)(t.guideStippleLengthPixels)})),this._segmentLabel=new q.a(Object(D.a)(Object(D.a)({},i),{},{fontSize:t.direcLabelFontSize})),this._verticalLabel=new q.a(Object(D.a)(Object(D.a)({},i),{},{fontSize:t.verticalLabelFontSize})),this._horizontalLabel=new q.a(Object(D.a)(Object(D.a)({},i),{},{fontSize:t.horizontalLabelFontSize})),this._handles.add([Object(g.a)((function(){return e._updateGeometryAndViewMode()})),Object(g.a)((function(){return e._updateVisualElementVisibility()})),Object(g.a)((function(){return e._updateLabelText()})),Object(g.a)((function(){return e._updateLabelVisibility()})),Object(g.a)((function(){return e._updateSegmentStripeLength()})),Object(Me.c)(Object(E.a)(P.a.mark((function t(){return P.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._updateMessageBundle());case 1:case"end":return t.stop()}}),t)}))))]),this._state=1,this._updateMessageBundle()}},{key:"destroy",value:function(){2!==this._state&&(this._handles=Object(l.e)(this._handles),this._segmentVisualElement=Object(l.e)(this._segmentVisualElement),this._triangleVisualElement=Object(l.e)(this._triangleVisualElement),this._rightAngleQuad=Object(l.e)(this._rightAngleQuad),this._projectedGeodesicLine=Object(l.e)(this._projectedGeodesicLine),this._geodesicStartHint=Object(l.e)(this._geodesicStartHint),this._geodesicEndHint=Object(l.e)(this._geodesicEndHint),this._segmentLabel=Object(l.e)(this._segmentLabel),this._verticalLabel=Object(l.e)(this._verticalLabel),this._horizontalLabel=Object(l.e)(this._horizontalLabel),this.set("view",null),this._state=2)}},{key:"whenReady",value:function(){var e=Object(E.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.j)(this,"ready");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"whenMessages",value:function(){var e=Object(E.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.whenReady();case 2:return e.next=4,Object(p.j)(this,"messages");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateVisualElementVisibility",value:function(){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,this.visible)switch(this.viewMode){case 0:break;case 1:this._segmentVisualElement.visible=!0;break;case 2:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case 3:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}},{key:"_updateGeometryAndViewMode",value:function(){var e=this.view.renderCoordsHelper,t=this.layer,i=t.startPoint,a=t.endPoint;if(Object(l.i)(i)||Object(l.i)(a)||i.equals(a)){this.viewMode=0;var n=this.visualizedMeasurement,r=0===n;this.actualVisualizedMeasurement=r?1:n}else{e.toRenderCoords(i,this._startPosition),e.toRenderCoords(a,this._endPosition);var s=this._getActualVisualElementsOrientation(),o=this._updateActualVisualizedMeasurement();this.viewMode=this._computeViewMode(o);var c=this._startPosition,u=this._endPosition,d=1===s?1:-1,h=d*(e.getAltitude(u)-e.getAltitude(c));h<0&&(c=this._endPosition,u=this._startPosition);var b=2===o?new Le.b(this._startPosition,this._endPosition,e.spatialReference):new Le.a(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=b,this._updateSegmentStripeLength(),this._segmentLabelDisplayedMeasurement=o,this.viewMode){case 1:this._updateSegment(b,s);break;case 2:this._updateSegmentAndTriangle(b,s,c,u,d,h);break;case 3:this._updateSegmentAndProjection(s)}}}},{key:"_updateSegment",value:function(e,t){this._segmentLabel.anchor=1===t?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}},{key:"_updateSegmentAndTriangle",value:function(e,t,i,a,n,r){var s=this.view,o=s.renderCoordsHelper,l=s.state.camera,c=this._cornerPosition;o.worldUpAtPosition(i,c),Object(j.g)(c,c,n*Math.abs(r)),Object(j.h)(c,c,i),this._triangleVisualElement.geometry=[[[i[0],i[1],i[2]],[c[0],c[1],c[2]],[a[0],a[1],a[2]]]],this._rightAngleQuad.geometry={previous:i,center:c,next:a};var u=new Le.a(i,c),d=new Le.a(c,a),h=function(e,t,i,a,n){var r=De,s=xe;n.projectToRenderScreen(i,r),n.projectToRenderScreen(t,s);var o={segment:"bottom",horizontal:"top",vertical:r[0]<s[0]?"left":"right"},l=Ae,c=Ge;if(Object(ke.b)(e,i,l,n),Object(ke.b)(e,t,c,n),Object(R.h)(l,c)>=Ee){var u=Object(O.t)(l[1])===Object(O.t)(c[1]);o.segment=u?Object(q.b)(o.vertical):o.vertical}else{var d=Re;Object(ke.b)(i,t,d,n),Object(R.h)(d,c)>=Ee&&(o.segment=Object(O.t)(d[0])===Object(O.t)(c[0])?Object(q.b)(o.horizontal):o.horizontal)}if(2===a){var h=function(e){return"top"===e?"bottom":"top"};o.segment=h(o.segment),o.horizontal=h(o.horizontal),o.vertical=h(o.vertical)}return o}(i,a,c,t,l);this._segmentLabel.anchor=h.segment,this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._verticalLabel.anchor=h.vertical,this._horizontalLabel.geometry={type:"segment",segment:d,sampleLocation:"center"},this._horizontalLabel.anchor=h.horizontal}},{key:"_updateSegmentAndProjection",value:function(e){var t=this.view.renderCoordsHelper;t.setAltitude(this._startPositionAtSeaLevel,0,this._startPosition),t.setAltitude(this._endPositionAtSeaLevel,0,this._endPosition);var i=new Le.b(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(i),this._geodesicStartHint.setGeometryFromSegment(new Le.a(this._startPositionAtSeaLevel,this._startPosition)),this._geodesicEndHint.setGeometryFromSegment(new Le.a(this._endPositionAtSeaLevel,this._endPosition)),this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._segmentLabel.anchor=1===e?"top":"bottom"}},{key:"_updateLabelText",value:function(){if(1===this._state){var e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel,a=this.messages,n=this.layerView.result;if(Object(l.i)(n)||Object(l.i)(a))return e.text=null,t.text=null,void(i.text=null);var r=this._getLabelsText(a,n),s=1===this._segmentLabelDisplayedMeasurement;e.text=s?r.euclideanDistance:r.geodesicDistance,t.text=r.horizontalDistance,i.text=r.verticalDistance,this.notifyChange("labels")}}},{key:"_updateLabelVisibility",value:function(){if(1===this._state){var e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel;if(e.visible=!1,t.visible=!1,i.visible=!1,this.visible)switch(this.viewMode){case 1:e.visible=!0;break;case 2:e.visible=!0,t.visible=!0,i.visible=!0;break;case 3:e.visible=!0}}}},{key:"_getLabelsText",value:function(e,t){var i=t.directDistance,a=t.horizontalDistance,n=t.verticalDistance,r=t.geodesicDistance,s=t.geodesicAngle,o=this.layerView.unit,l=function(e){return Object(D.a)({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},e)};switch(o){case"metric":return l({euclideanDistance:i&&Object(x.e)(e,i),geodesicDistance:r&&Object(x.e)(e,r),horizontalDistance:a&&Object(x.e)(e,a),verticalDistance:n&&Object(x.f)(e,n)});case"imperial":return l({euclideanDistance:i&&Object(x.c)(e,i),geodesicDistance:r&&Object(x.c)(e,r),horizontalDistance:a&&Object(x.c)(e,a),verticalDistance:n&&Object(x.d)(e,n)});case"degrees":var c=s&&Object(x.b)(e,s,"degrees");return l({euclideanDistance:c,geodesicDistance:c,horizontalDistance:c});case"degrees-minutes-seconds":return l({horizontalDistance:s&&Object(x.a)(s)});default:return l({euclideanDistance:i&&Object(x.b)(e,i,o),geodesicDistance:r&&Object(x.b)(e,r,o),horizontalDistance:a&&Object(x.b)(e,a,o),verticalDistance:n&&Object(x.b)(e,n,o)})}}},{key:"_updateSegmentStripeLength",value:function(){var e=this._measurementArrowStripeLength,t=this._segmentVisualElement;Object(l.j)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}},{key:"_computeViewMode",value:function(e){if(2===e){if(!this._geodesicDistanceExceeded)return 1;if(this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition))return 3}var t=this.layerView.result;if(Object(l.i)(t))return 1;var i=t.verticalDistance,a=t.horizontalDistance,n=i.value,r=a.value;return Math.min(n/r,r/n)<this.triangleCollapseRatioThreshold?1:2}},{key:"_getActualVisualElementsOrientation",value:function(){if(Object(l.j)(this._triangleOrientationOverride))return this._triangleOrientationOverride;var e=this.visualElementOrientation;return 0===e?this.view.state.camera.aboveGround?1:2:e}},{key:"_updateActualVisualizedMeasurement",value:function(){if(0===this.visualizedMeasurement){this.actualVisualizedMeasurement=1;var e=this.layerView.unit;"degrees"!==e&&"degrees-minutes-seconds"!==e||(this.actualVisualizedMeasurement=2),this._geodesicDistanceExceeded&&(this.actualVisualizedMeasurement=2)}else this.actualVisualizedMeasurement=this.visualizedMeasurement;return this.actualVisualizedMeasurement}},{key:"_requiresGeodesicGuideAt",value:function(e){var t=this.view;if(!t.state)return!1;var i=t.state.camera,a=t.renderCoordsHelper,n=i.computeScreenPixelSizeAt(e);return a.getAltitude(e)/n>=10}},{key:"_measurementArrowStripeLength",get:function(){var e=this.view,t=this.layerView,i=t.result,a=t.unit,n=null;if(Object(l.j)(i)){var r=i.directDistance;switch(a){case"metric":n=r&&r.toUnit("meters");break;case"imperial":n=r&&r.toUnit(Object(G.p)(r.value,r.unit));break;case"degrees":case"degrees-minutes-seconds":var s=i.geodesicAngle;n=s&&s.toUnit("degrees");break;default:n=r&&r.toUnit(a)}}if(n){var o=1;return o=Object(O.o)(n.value/30),o*="degrees"===n.unit?Object(L.e)(e.spatialReference).metersPerDegree:Object(G.c)(1,n.unit,"meters")}return null}},{key:"_updateMessageBundle",value:function(){var e=this;Object(Ce.a)("esri/core/t9n/Units").then((function(t){e.messages=t,e.view&&e._updateLabelText()}))}}]),i}(b.a);Object(o.a)([Object(c.b)()],Se.prototype,"_state",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"_segmentLabelDisplayedMeasurement",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"_triangleOrientationOverride",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"_geodesicDistanceExceeded",null),Object(o.a)([Object(c.b)()],Se.prototype,"messages",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"view",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"layer",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"layerView",void 0),Object(o.a)([Object(c.b)({readOnly:!0})],Se.prototype,"ready",null),Object(o.a)([Object(c.b)({readOnly:!0})],Se.prototype,"visible",null),Object(o.a)([Object(c.b)()],Se.prototype,"viewMode",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"visualizedMeasurement",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"actualVisualizedMeasurement",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"visualElementOrientation",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"triangleCollapseRatioThreshold",void 0),Object(o.a)([Object(c.b)()],Se.prototype,"allowVisualElementsOrientationChange",null),Object(o.a)([Object(c.b)()],Se.prototype,"labels",null),Object(o.a)([Object(c.b)()],Se.prototype,"testData",null),Object(o.a)([Object(c.b)()],Se.prototype,"_measurementArrowStripeLength",null),Se=Object(o.a)([Object(u.a)("esri.views.3d.layers.DirectLineMeasurement.DirectLineMeasurementView")],Se);var Ve=Object(T.c)(1,.5,0,.75),Pe={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:Ve,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:Ve,guideLineWidth:2,guideLineColor:Ve,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Ee=Math.cos(Object(O.g)(12)),De=Object(A.d)(),xe=Object(A.d)(),Ae=Object(A.c)(),Ge=Object(A.c)(),Re=Object(A.c)(),Te=i(571),qe=function(e){Object(r.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e))._userUnit=null,n.type="direct-line-measurement-3d",n.result=null,n}return Object(n.a)(i,[{key:"unit",get:function(){return Object(l.t)(this._userUnit,this._defaultUnit)},set:function(e){this._userUnit=e}},{key:"viewMode",get:function(){return this._analysisView.viewMode}},{key:"visualizedMeasurement",get:function(){return this._analysisView.visualizedMeasurement},set:function(e){this._analysisView.visualizedMeasurement=e}},{key:"actualVisualizedMeasurement",get:function(){return this._analysisView.actualVisualizedMeasurement}},{key:"visualElementOrientation",get:function(){return this._analysisView.visualElementOrientation},set:function(e){this._analysisView.visualElementOrientation=e}},{key:"allowVisualElementsOrientationChange",get:function(){return this._analysisView.allowVisualElementsOrientationChange},set:function(e){this._analysisView.allowVisualElementsOrientationChange=e}},{key:"triangleCollapseRatioThreshold",get:function(){return this._analysisView.triangleCollapseRatioThreshold},set:function(e){this._analysisView.triangleCollapseRatioThreshold=e}},{key:"directLabelText",get:function(){return this._analysisView.labels.direct.text}},{key:"horizontalLabelText",get:function(){return this._analysisView.labels.horizontal.text}},{key:"verticalLabelText",get:function(){return this._analysisView.labels.vertical.text}},{key:"testData",get:function(){return this._analysisView.testData}},{key:"initialize",value:function(){var e=this.view,t=this.layer;this._analysisView=new Se({view:e,layer:t,layerView:this}),this._analysisController=new M({view:e,layer:t,viewData:this})}},{key:"destroy",value:function(){Object(l.e)(this._analysisController),Object(l.e)(this._analysisView)}},{key:"whenReady",value:function(){return this._analysisView.whenReady()}},{key:"whenMessages",value:function(){return this._analysisView.whenMessages()}}]),i}(Object(h.a)(Te.a));Object(o.a)([Object(c.b)(d.a)],qe.prototype,"_defaultUnit",void 0),Object(o.a)([Object(c.b)()],qe.prototype,"_userUnit",void 0),Object(o.a)([Object(c.b)()],qe.prototype,"_analysisView",void 0),Object(o.a)([Object(c.b)()],qe.prototype,"_analysisController",void 0),Object(o.a)([Object(c.b)()],qe.prototype,"type",void 0),Object(o.a)([Object(c.b)()],qe.prototype,"unit",null),Object(o.a)([Object(c.b)()],qe.prototype,"layer",void 0),Object(o.a)([Object(c.b)()],qe.prototype,"result",void 0),Object(o.a)([Object(c.b)({readOnly:!0})],qe.prototype,"viewMode",null),Object(o.a)([Object(c.b)()],qe.prototype,"visualizedMeasurement",null),Object(o.a)([Object(c.b)({readOnly:!0})],qe.prototype,"actualVisualizedMeasurement",null),Object(o.a)([Object(c.b)()],qe.prototype,"visualElementOrientation",null),Object(o.a)([Object(c.b)()],qe.prototype,"allowVisualElementsOrientationChange",null),Object(o.a)([Object(c.b)()],qe.prototype,"triangleCollapseRatioThreshold",null),Object(o.a)([Object(c.b)({readOnly:!0})],qe.prototype,"directLabelText",null),Object(o.a)([Object(c.b)({readOnly:!0})],qe.prototype,"horizontalLabelText",null),Object(o.a)([Object(c.b)({readOnly:!0})],qe.prototype,"verticalLabelText",null),Object(o.a)([Object(c.b)()],qe.prototype,"testData",null);var Ue=qe=Object(o.a)([Object(u.a)("esri.views.3d.layers.DirectLineMeasurementLayerView3D")],qe);t.default=Ue},880:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var a,n,r=i(12),s=i(11),o=i(87);function l(){var e=new o.a;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("auxpos1","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(Object(s.a)(a||(a=Object(r.a)(["void main(void) {\nvec3 bitangent = normal;\nvtc = uv0;\nvlength = auxpos1;\nvradius = 0.5 * width;\nvec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\ngl_Position = proj * pos;\n}"])))),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");var t=1/Math.sqrt(2);return e.fragment.code.add(Object(s.a)(n||(n=Object(r.a)(["\n    const float INV_SQRT2 = ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      } else if (d < outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n      vec4 color = arrowColor(ntc, vlength / vradius);\n      if (color.a == 0.0) {\n        discard;\n      }\n      gl_FragColor = color;\n    }\n  "])),s.a.float(t))),e}var c=Object.freeze({__proto__:null,build:l})}}]);
//# sourceMappingURL=90.7f0922fa.chunk.js.map