{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/ImageryLayerView.js","../node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js"],"names":["u","m","arguments","view","e","o","a","s","this","layer","r","i","popupEnabled","n","t","popupTemplate","getRequiredFields","c","timeExtent","geometry","outFields","outSpatialReference","spatialReference","l","resolution","y","type","p","layerOptions","returnTopmostRaster","showNoDataRecords","h","w","d","returnDomainValues","pixelSize","signal","queryVisibleRasters","then","isEmpty","prototype","redrawDebounced","redraw","_redrawImage","handles","add","basemapTerrain","initializeMaximumDataResolution","on","updatingHandles","addPromise","refreshDebounced","fullExtent","equals","maximumDataResolution","x","pixelSizeX","pixelSizeY","imageElement","image","document","createElement","pixelData","HTMLCanvasElement","Promise","reject","getContext","applyRenderer","applyFilter","pixelBlock","width","height","createImageData","data","set","getAsRGBA","putImageData","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","f","push","has","indexOf","forEach","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate"],"mappings":"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","file":"static/js/143.f6cd2249.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import p from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import a from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as n}from\"./support/popupUtils.js\";const u=u=>{let m=class extends u{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:s}=this;if(!e)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s});const{popupEnabled:i}=s,u=n(s,o);if(!i||!t(u))throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:u});const m=await u.getRequiredFields(),c=new a;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=m,c.outSpatialReference=e.spatialReference;const l=this.view.resolution,y=\"2d\"===this.view.type?new p(l,l,this.view.spatialReference):new p(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:w}=u.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},d={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:y,showNoDataRecords:w,signal:t(o)?o.signal:null};return s.queryVisibleRasters(c,d).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],m.prototype,\"layer\",void 0),e([o()],m.prototype,\"suspended\",void 0),e([o(i)],m.prototype,\"timeExtent\",void 0),e([o()],m.prototype,\"view\",void 0),m=e([s(\"esri.views.layers.ImageryLayerView\")],m),m};export default u;export{u as ImageryLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{debounce as t}from\"../../../core/promiseUtils.js\";import{whenOnce as a}from\"../../../core/watchUtils.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"./DynamicLayerView3D.js\";import{ImageryLayerView as s}from\"../../layers/ImageryLayerView.js\";let o=class extends(s(r)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=t((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([a(this.view.basemapTerrain,\"ready\",(()=>this.initializeMaximumDataResolution())),this.layer.on(\"redraw\",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,\"exportImageServiceParameters.version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,\"timeExtent\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement(\"canvas\"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement&&e.pixelData))return Promise.reject();const a=e.image,i=a.getContext(\"2d\"),r=await this.layer.applyRenderer(e.pixelData,{signal:t}),s=this.layer.applyFilter(r),o=s.pixelBlock;a.width=o.width,a.height=o.height;const n=i.createImageData(o.width,o.height);n.data.set(s.pixelBlock.getAsRGBA()),i.putImageData(n,0,0)}};o=e([i(\"esri.views.3d.layers.ImageryLayerView3D\")],o);var n=o;export default n;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n"],"sourceRoot":""}