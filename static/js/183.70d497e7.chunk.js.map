{"version":3,"sources":["../node_modules/@arcgis/core/libs/vxl/VxlModule.js","../node_modules/@arcgis/core/layers/VoxelWasmPerScene.js","../node_modules/@arcgis/core/layers/VoxelWasmManager.js","../node_modules/@arcgis/core/views/3d/layers/VoxelLayerView3D.js"],"names":["n","t","e","v","getLogger","p","this","_useDepthPass","_havePreparedWithAllLayers","_renderPluginContext","_vxl","_pluginIsActive","_moreToLoad","_viewportWidth","_viewportHeight","_newLayers","_layers","Map","_renderPass","_renderSlot","_rctx","_renderTargetToRestore","_dbgFlags","Set","add","_view","initialize","viewingMode","has","error","warn","_stage","dbg","removeRenderPlugin","_readyWatchHandle","addRenderPlugin","_qualityWatchHandle","set_quality","toWasmQuality","renderContext","rctx","webglVersion","initializeWasm","gl","fbo","bindFramebuffer","viewport","setViewport","x","y","width","height","s","i","r","depthStencilTexture","bindTexture","setBlendingEnabled","setBlendFunction","setBlendEquation","setFrontFace","setDepthFunction","setDepthTestEnabled","setDepthWriteEnabled","setStencilTestEnabled","setStencilFunction","setStencilOpSeparate","setFaceCullingEnabled","setCullFace","forEach","responses","push","size","respond","delete","a","get_new_requests","l","abortController","signal","o","outstandingRequestCount","layerView","updatingFlagChanged","responseType","url","then","data","byteLength","_malloc","Uint8Array","HEAPU8","buffer","set","type","ptr","success","catch","set_projection_matrix","apply","projectionMatrix","set_view_matrix","viewMatrix","set_near_far","near","far","_vxlPromise","get","set_enabled","requestRender","resolveCallback","rejectCallback","Promise","_addVoxelLayer","reject","resolve","findIndex","splice","length","destroy","abort","remove_layer","layer","layerData","spatialReference","wkid","isWGS84","add_layer","serviceRoot","_free","viewForward","eye","update_camera_pos_and_direction","cull","pass","slot","getBoundFramebufferObject","getViewport","syncRequestsResponses","begin_frame","set_viewport","updateWasmCamera","camera","draw","externalTextureUnitUpdate","get_texture_units_bound_in_frame","get_active_texture_unit","externalVertexArrayObjectUpdate","externalVertexBufferUpdate","get_near","get_far","remove","uninitialize_voxel_wasm","default","locateFile","preinitializedWebGLContext","onRuntimeInitialized","g","addFunction","restoreFramebuffer","bind","setBlendState","setRasterizerState","setDepthStencilStateFunction","bindPreviousDepthToSlot","initialize_voxel_wasm","qualityProfile","intersectDepth","intersectObject","pick_object","u","h","worldX","worldY","worldZ","b","d","c","w","_","f","m","R","intersector","dist","target","metadata","layerUid","intersectionHandlerId","C","results","min","P","max","options","store","ray","all","pick_depth","view2WASM","isUpdating","addVoxelLayer","removeVoxelLayer","setEnabled","instance","arguments","_wasmLayerId","view","getInstance","addLayer","_suspendedHandle","setLayerEnabled","removeLayer","addResolvingPromise","notifyChange","prototype","readOnly","aliasOf"],"mappings":"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","file":"static/js/183.70d497e7.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as e}from\"../../assets.js\";function t(e){return new Promise((t=>import(\"../../chunks/vxlLayer.js\").then((function(e){return e.v})).then((({default:i})=>{const r=i({locateFile:n,preinitializedWebGLContext:e,onRuntimeInitialized:()=>t(r)})})))).catch((e=>Promise.reject(e)))}function n(t){return e(`esri/libs/vxl/${t}`)}export{t as loadVoxelWASM};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../request.js\";import t from\"../core/Logger.js\";import{clamp as s}from\"../core/mathUtils.js\";import{isAbortError as i,createAbortController as r}from\"../core/promiseUtils.js\";import{init as n}from\"../core/watchUtils.js\";import{w as a,n as l,i as o,s as h,a as d,d as c,b as _}from\"../chunks/vec3.js\";import{c as u}from\"../chunks/vec3f64.js\";import{loadVoxelWASM as g}from\"../libs/vxl/VxlModule.js\";import{IntersectorResult as x}from\"../views/3d/webgl-engine/lib/intersectorUtils.js\";const v=t.getLogger(\" esri.layers.VoxelWasmPerScene\");class p{constructor(e){this._useDepthPass=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=0,this._renderSlot=4,this._rctx=null,this._renderTargetToRestore=null,this._dbgFlags=new Set,this._dbgFlags.add(4),this._view=e,this.initialize()}get canRender(){return!!this._vxl&&\"local\"===this._view.viewingMode}dbg(e,t){this._dbgFlags.has(e)&&(4===e?v.error(t):v.warn(t))}removeRenderPlugin(){this._pluginIsActive&&this._view._stage&&(this.dbg(1,\"--removeRenderPlugin--\"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}initialize(){this.dbg(1,\"--initialize--\"),this._readyWatchHandle=n(this._view,\"ready\",(e=>{e&&\"local\"===this._view.viewingMode?(this.dbg(1,\"view ready status changed to ready on a local view, calling addRenderPlugin\"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this.dbg(1,\"view ready status changed, not ready or not a local view!\"),this.removeRenderPlugin())})),this._qualityWatchHandle=n(this._view,\"qualityProfile\",(e=>{this.dbg(3,\"qualityProfile changed to \"+e),this._vxl&&this._vxl.set_quality(this.toWasmQuality(e))}))}initializeRenderContext(e){this.dbg(1,\"--initializeRenderContext--\");const t=e.renderContext.rctx;\"webgl2\"===t.webglVersion?(this._renderPluginContext=e,this._rctx=e.renderContext.rctx,this.initializeWasm(t.gl)):this.dbg(4,\"WebGL 1 context only!\")}uninitializeRenderContext(){this._renderPluginContext=null,this._rctx=null,this.dbg(1,\"--uninitializeRenderContext--\")}restoreFramebuffer(){if(!this._renderTargetToRestore)return;const e=this._renderTargetToRestore.fbo;if(!!!this._rctx)return void this.dbg(4,\"no context in restoreFramebuffer!\");this._rctx.bindFramebuffer(e,!0);const t=this._renderTargetToRestore.viewport;this._rctx.setViewport(t.x,t.y,t.width,t.height)}bindPreviousDepthToSlot(e,t){const s=!!this._rctx,i=!!this._renderTargetToRestore;if(!s||!i)return 0;const r=this._renderTargetToRestore.fbo.depthStencilTexture;return r?(0===t?this._rctx.bindTexture(null,e,!0):this._rctx.bindTexture(r,e,!0),1):(this.dbg(4,\"no depth/stencil texture exists!\"),0)}setBlendState(e,t,s,i){this._rctx?(this._rctx.setBlendingEnabled(1===e),this._rctx.setBlendFunction(t,s),this._rctx.setBlendEquation(i)):this.dbg(4,\"setBlendState callback has no rendering context!\")}setFrontFace(e){this._rctx?this._rctx.setFrontFace(e):this.dbg(4,\"setFrontFace callback has no rendering context!\")}setDepthStencilStateFunction(e,t,s){this._rctx?(this._rctx.setDepthFunction(s),this._rctx.setDepthTestEnabled(1===e),this._rctx.setDepthWriteEnabled(1===t),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(519,0,255),this._rctx.setStencilOpSeparate(1028,7680,7682,7680),this._rctx.setStencilOpSeparate(1029,7680,7683,7680)):this.dbg(4,\"setDepthStencilStateFunction callback has no rendering context!\")}setRasterizerState(e){if(this._rctx)switch(e){case 1:this._rctx.setFaceCullingEnabled(!1);break;case 3:this._rctx.setCullFace(1029),this._rctx.setFaceCullingEnabled(!0);break;case 2:this._rctx.setCullFace(1028),this._rctx.setFaceCullingEnabled(!0)}else this.dbg(4,\"setRasterizerState callback has no rendering context!\")}setViewport(e,t,s,i){this._rctx?this._rctx.setViewport(e,t,s,i):this.dbg(4,\"setViewport callback has no rendering context!\")}syncRequestsResponses(){this._layers.forEach(((t,s)=>{const r=[];t.responses.forEach(((e,t)=>{r.push(t),this.dbg(2,\"responding for requestID:\"+t+\" size:\"+e.size),this._vxl.respond(s,t,e)}));const n=t.responses;for(const e of r)n.delete(e);const a=this._vxl.get_new_requests(s),l=t.abortController.signal;for(const o in a){t.outstandingRequestCount+=1,1===t.outstandingRequestCount&&t.layerView.updatingFlagChanged();const s=a[o],r={responseType:\"array-buffer\",signal:l};this.dbg(2,\"making requestID:\"+o+\" url:\"+s.url),e(s.url,r).then((e=>{t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),this.dbg(2,\"have response for requestID:\"+o);let i=0;if(e.data.byteLength>0){i=this._vxl._malloc(e.data.byteLength);const t=new Uint8Array(this._vxl.HEAPU8.buffer,i,e.data.byteLength),s=new Uint8Array(e.data);for(let i=0;i<e.data.byteLength;++i)t[i]=s[i]}n.set(+o,{type:s.type,ptr:i,size:e.data.byteLength,success:!0})})).catch((e=>{t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),i(e)||(this.dbg(4,\"requestID:\"+o+\" failed\"),n.set(+o,{type:s.type,ptr:0,size:0,success:!1}))}))}}))}updateWasmCamera(e){this._vxl.set_projection_matrix.apply(this._vxl,e.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,e.viewMatrix),this._vxl.set_near_far(e.near,e.far)}isUpdating(e){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(e)&&this._layers.get(e).outstandingRequestCount>0}setEnabled(e,t){this._layers.forEach(((s,i)=>{s.layerView===e&&(this._vxl.set_enabled(i,t?1:0),this._renderPluginContext.requestRender())}))}addVoxelLayer(e){if(!this._vxl){const t={layerView:e,resolveCallback:\"\",rejectCallback:\"\"},s=new Promise(((e,s)=>{t.resolveCallback=e,t.rejectCallback=s}));return this._newLayers.push(t),s}const t=this._addVoxelLayer(e);return t<0?Promise.reject(-1):Promise.resolve(t)}removeVoxelLayer(e){if(!this._vxl){const t=this._newLayers.findIndex((t=>e===t.layerView));t>=0&&(this._newLayers[t].resolveCallback(-1),this._newLayers.splice(t,1));const s=this._newLayers.length;return 0===s&&(this.dbg(1,\" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"),this.destroy()),s}let t=-1;this._layers.forEach(((s,i)=>{s.layerView===e&&(t=i,s.abortController.abort(),this._vxl.remove_layer(t))})),t>=0&&this._layers.delete(t);const s=this._layers.size;return 0===s&&(this.dbg(1,\" no voxel layers left after removing a layer, removing RenderPlugin and destroying\"),this.destroy()),s}_addVoxelLayer(e){const t=e.layer;let s=-1;const i=t.layerData;if(i&&i.data.byteLength>0){const e=this._vxl._malloc(i.data.byteLength),r=new Uint8Array(this._vxl.HEAPU8.buffer,e,i.data.byteLength),n=new Uint8Array(i.data);for(let t=0;t<i.data.byteLength;++t)r[t]=n[t];const a=32662===this._view.spatialReference.wkid&&t.spatialReference.isWGS84?111319.49079327357:1;s=this._vxl.add_layer(t.serviceRoot,e,i.data.byteLength,a,a),this._vxl._free(e)}if(s>=0){const t=r();return this._layers.set(s,{layerView:e,responses:new Map,outstandingRequestCount:0,abortController:t}),s}return-1}prepareRender(e){if(!this._vxl)return;const t=e.viewForward,s=e.eye;this._vxl.update_camera_pos_and_direction(s[0],s[1],s[2],t[0],t[1],t[2]);const i=this._vxl.cull();this.dbg(2,\"missingResourceCount=\"+i),this._moreToLoad=i>0,this._havePreparedWithAllLayers=0===this._newLayers.length}render(e){if(!this._vxl)return!1;for(const s of this._newLayers){const e=this._addVoxelLayer(s.layerView);-1===e?s.rejectCallback(-1):s.resolveCallback(e)}if(this._newLayers=[],e.pass!==this._renderPass)return!1;if(e.slot!==this._renderSlot)return!1;if(0===this._layers.size)return this.dbg(4,\"No voxel layers but RenderPlugin instance is being asked to render!\"),!0;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this.syncRequestsResponses(),this._vxl.begin_frame();const t=this._renderTargetToRestore.viewport;return t.width===this._viewportWidth&&t.height===this._viewportHeight||(this._viewportWidth=t.width,this._viewportHeight=t.height,this._vxl.set_viewport(t.width,t.height)),0===t.x&&0===t.y||this.dbg(4,\"Unsupported viewport parameters detected!\"),this.updateWasmCamera(e.camera),this._vxl.draw(),this._renderTargetToRestore.fbo=null,e.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),e.rctx.externalVertexArrayObjectUpdate(),e.rctx.externalVertexBufferUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender(),!0}queryDepthRange(e){this.dbg(1,\"--queryDepthRange--\");const t=e.viewForward,s=e.eye;this._vxl.update_camera_pos_and_direction(s[0],s[1],s[2],t[0],t[1],t[2]),this._vxl.cull();const i={near:5,far:1e4};return i.near=this._vxl.get_near(),i.far=this._vxl.get_far(),i}destroy(){this.dbg(1,\"--destroy--\"),this.removeRenderPlugin(),this._readyWatchHandle&&(this._readyWatchHandle.remove(),this._readyWatchHandle=null),this._qualityWatchHandle&&(this._qualityWatchHandle.remove(),this._qualityWatchHandle=null),this._vxl&&(this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}initializeWasm(e){return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=g(e).then((e=>{if(this._vxl=e,this._vxlPromise=null,this._newLayers.length<=0)return this.dbg(1,\" no voxel layers left after WASM downloaded, removing RenderPlugin and destroying\"),void this.destroy();const t=this._vxl.addFunction(this.restoreFramebuffer.bind(this),\"v\"),s=this._vxl.addFunction(this.setBlendState.bind(this),\"viiii\"),i=this._vxl.addFunction(this.setFrontFace.bind(this),\"vi\"),r=this._vxl.addFunction(this.setRasterizerState.bind(this),\"vi\"),n=this._vxl.addFunction(this.setDepthStencilStateFunction.bind(this),\"viii\"),a=this._vxl.addFunction(this.setViewport.bind(this),\"viiii\"),l=this._vxl.addFunction(this.bindPreviousDepthToSlot.bind(this),\"iii\");this._vxl.initialize_voxel_wasm(t,s,i,r,n,a,l),this._vxl.set_quality(this.toWasmQuality(this._view.qualityProfile)),this._renderPluginContext&&this._renderPluginContext.requestRender()})).catch((()=>{for(const e of this._newLayers)e.rejectCallback(-2);this.dbg(4,\" WASM failed to download, removing RenderPlugin and destroying\"),this.destroy()}))),this._vxlPromise)}get type(){return\"external\"}get isGround(){return!1}get slicePlane(){return!1}get intersectionHandlerId(){return\"unj\"}intersect(e,t,s,i,r){if(!this._vxl)return;if(!this._rctx)return;if(0===this._layers.size)return;if(r[0]<0||r[0]>e.camera.viewport[2]||r[1]<0||r[1]>e.camera.viewport[3])return;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};const n=e.camera.viewForward,a=e.camera.eye;this._vxl.update_camera_pos_and_direction(a[0],a[1],a[2],n[0],n[1],n[2]),this.updateWasmCamera(e.camera),this._vxl.begin_frame(),this._useDepthPass?this.intersectDepth(e,t,s,i,r):this.intersectObject(e,t,s,i,r),this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate()}intersectObject(e,t,i,r,n){const g=this._vxl.pick_object(n[0],n[1]);if(g.success){const n=u();a(n,r,i),l(n,n);const v=o(i,r),p=u();h(p,g.worldX,g.worldY,g.worldZ);const y=u();a(y,p,i);const b=u();d(b,n,c(y,n));const w=u();_(w,i,b);const f=o(i,w),m=s(f/v,0,1),R=e=>{e.intersector=\"Voxel\",e.dist=m,e.target={type:\"external\",metadata:{layerUid:this.intersectionHandlerId}}},C=e.results.min;(null==C.dist||m<C.dist)&&(null==t||t(i,r,m))&&R(C);const P=e.results.max;if(0!==e.options.store&&(null==P.dist||m>P.dist)&&(null==t||t(i,r,m))&&R(P),2===e.options.store){const t=new x(e.ray);R(t),e.results.all.push(t)}}}intersectDepth(e,t,i,r,n){const g=this._vxl.pick_depth(n[0],n[1]);if(g.success){const n=u();a(n,r,i),l(n,n);const v=o(i,r),p=u();h(p,g.worldX,g.worldY,g.worldZ);const y=u();a(y,p,i);const b=u();d(b,n,c(y,n));const w=u();_(w,i,b);const f=o(i,w),m=s(f/v,0,1),R=e=>{e.intersector=\"Voxel\",e.dist=m,e.target={type:\"external\",metadata:{layerUid:this.intersectionHandlerId}}},C=e.results.min;(null==C.dist||m<C.dist)&&(null==t||t(i,r,m))&&R(C);const P=e.results.max;if(0!==e.options.store&&(null==P.dist||m>P.dist)&&(null==t||t(i,r,m))&&R(P),2===e.options.store){const t=new x(e.ray);R(t),e.results.all.push(t)}}}toWasmQuality(e){switch(e){case\"low\":return 0;case\"medium\":return 1;case\"high\":return 2}}}export default p;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"./VoxelWasmPerScene.js\";class t{constructor(){this.view2WASM=new Map}static getInstance(){return t.instance||(t.instance=new t),t.instance}isUpdating(e,t){return!!this.view2WASM.has(e)&&this.view2WASM.get(e).isUpdating(t)}addLayer(t,i){return this.view2WASM.has(t)||this.view2WASM.set(t,new e(t)),this.view2WASM.get(t).addVoxelLayer(i)}removeLayer(e,t){if(this.view2WASM.has(e)){this.view2WASM.get(e).removeVoxelLayer(t)<1&&this.view2WASM.delete(e)}}setLayerEnabled(e,t,i){if(this.view2WASM.has(e)){this.view2WASM.get(e).setEnabled(t,i)}}}export default t;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import s from\"../../../core/Error.js\";import{init as r}from\"../../../core/watchUtils.js\";import{property as t}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import i from\"../../../layers/VoxelWasmManager.js\";import{LayerView3D as a}from\"./LayerView3D.js\";import d from\"../../layers/LayerView.js\";let n=class extends(a(d)){constructor(){super(...arguments),this.type=\"voxel-3d\",this._wasmLayerId=-1}initialize(){if(\"local\"!==this.view.viewingMode)throw new s(\"voxel:unsupported-viewingMode\",\"Voxel layers support local viewingMode only.\",{});if(\"webgl\"===this.view.renderContext)throw new s(\"voxel:unsupported-context\",\"Voxel layers are supported in WebGL2 rendering contexts only.\",{});const e=i.getInstance(),t=e.addLayer(this.view,this).then((e=>{this._wasmLayerId=e,this._suspendedHandle=r(this,\"suspended\",(e=>{i.getInstance().setLayerEnabled(this.view,this,!e)}))})).catch((r=>{if(e.removeLayer(this.view,this),this._wasmLayerId=-1,-1===r)throw new s(\"voxel:addLayer-failure\",\"The voxel layer description was invalid.\",{});if(-2===r)throw new s(\"voxel:addLayer-failure\",\"The voxel layer web assembly module failed to download.\",{})}));this.addResolvingPromise(t)}destroy(){i.getInstance().removeLayer(this.view,this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null)}isUpdating(){return!(this._wasmLayerId<0)&&i.getInstance().isUpdating(this.view,this._wasmLayerId)}updatingFlagChanged(){this.notifyChange(\"updating\")}};e([t()],n.prototype,\"layer\",void 0),e([t({readOnly:!0,aliasOf:\"layer.parsedUrl.path\"})],n.prototype,\"baseUrl\",void 0),n=e([o(\"esri.views.3d.layers.VoxelLayerView3D\")],n);var l=n;export default l;\n"],"sourceRoot":""}