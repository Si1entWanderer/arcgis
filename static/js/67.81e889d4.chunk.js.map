{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/MapImageLayerView.js","../node_modules/@arcgis/core/views/3d/layers/MapImageLayerView3D.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js","../node_modules/@arcgis/core/layers/support/sublayerUtils.js","../node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"names":["c","y","this","exportImageParameters","i","layer","destroy","e","commitProperty","_get","s","a","Promise","reject","r","p","get","l","minScale","o","maxScale","visible","sublayers","forEach","popupEnabled","u","defaultPopupTemplateEnabled","t","unshift","sublayer","popupTemplate","toArray","reverse","map","all","load","catch","createQuery","event","m","renderer","createFetchPopupFeaturesQueryGeometry","geometry","n","outFields","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","timeExtent","isEmpty","prototype","readOnly","arguments","type","updatingHandles","add","addPromise","refreshDebounced","view","timestamp","refreshTimestamp","d","getRequiredFields","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","f","push","has","indexOf","keyField","defaultPopupTemplate","xoffset","Math","max","abs","yoffset","stops","length","size","maxSize","minSize","floor","pointerType","visualVariables","symbol","uniqueValueInfos","classBreakInfos","resolution","overlayPixelSizeInMapUnits","basemapSpatialReference","equals","spatialReference","x","xmin","min","ymin","xmax","ymax","flatten","some","originIdOf","source","mapLayerId","id","gdbVersion","slice","layerDefinition","definitionExpression","labelingInfo","labelsVisible","opacity","scale","hasDynamicLayers","visibleSublayers","toExportImageJSON","JSON","stringify","serviceSublayers","_set","handles","remove","allSublayers","on","notifyChange","propertyName","join","dpi","format","imageFormat","transparent","imageTransparency","dynamicLayers","layers","layerDefs","Number"],"mappings":"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","file":"static/js/67.81e889d4.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as p}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as i}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as m}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as l}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const c=c=>{let y=class extends c{initialize(){this.exportImageParameters=new i({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const p=this.get(\"view.scale\"),i=[],l=async e=>{const r=0===e.minScale||p<=e.minScale,o=0===e.maxScale||p>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(l);else if(e.popupEnabled){const r=u(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&i.unshift({sublayer:e,popupTemplate:r})}},c=a.sublayers.toArray().reverse().map(l);await Promise.all(c);const y=i.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),p=t(s)?s.event:null,i=m({renderer:r.renderer,event:p}),l=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=l,a.outFields=await n(r,o);const u=await this._loadArcadeModules(o);u&&u.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=l.width/i);return(await r.queryFeatures(a)).features}));return(await o(y)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return l()}};return e([s()],y.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],y.prototype,\"exportImageVersion\",null),e([s()],y.prototype,\"layer\",void 0),e([s()],y.prototype,\"suspended\",void 0),e([s(p)],y.prototype,\"timeExtent\",void 0),y=e([a(\"esri.views.layers.MapImageLayerView\")],y),y};export default c;export{c as MapImageLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{MapImageLayerView as t}from\"../../layers/MapImageLayerView.js\";import{createQueryGeometry as o}from\"../../support/drapedUtils.js\";let i=class extends(t(s)){constructor(){super(...arguments),this.type=\"map-image-3d\"}initialize(){this.updatingHandles.add(this,\"exportImageVersion\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,r){return o(e,r,this.view)}getFetchOptions(){return{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp}}};i=e([r(\"esri.views.3d.layers.MapImageLayerView3D\")],i);var a=i;export default a;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction e(e,n,i){if(n.flatten((({sublayers:e})=>e)).length!==e.length)return!0;return!!e.some((e=>e.originIdOf(\"minScale\")>i||e.originIdOf(\"maxScale\")>i||e.originIdOf(\"renderer\")>i||e.originIdOf(\"labelingInfo\")>i||e.originIdOf(\"opacity\")>i||e.originIdOf(\"labelsVisible\")>i||e.originIdOf(\"source\")>i))||!r(e,n)}function n(e,n,i){return!!e.some((e=>{const n=e.source;return!(!n||\"map-layer\"===n.type&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===i.gdbVersion))||e.originIdOf(\"renderer\")>2||e.originIdOf(\"labelingInfo\")>2||e.originIdOf(\"opacity\")>2||e.originIdOf(\"labelsVisible\")>2}))||!r(e,n)}function r(e,n){if(!e||!e.length)return!0;const r=n.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const o=r.length;for(const{id:t}of e){for(;i<o&&r[i]!==t;)i++;if(i>=o)return!1}return!0}function i(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}export{n as isExportDynamic,i as isSublayerOverhaul,e as shouldWriteSublayerStructure};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{isExportDynamic as o}from\"./sublayerUtils.js\";const l={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let n=class extends(s(r)){constructor(e){super(e),this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&o(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(l[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,r)=>(e[r.id]=r.definitionExpression,e)),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,a=0===r.minScale||t<=r.minScale,o=0===r.maxScale||t>=r.maxScale;r.visible&&(i||a&&o)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([t({readOnly:!0})],n.prototype,\"dynamicLayers\",null),e([t({readOnly:!0})],n.prototype,\"hasDynamicLayers\",null),e([t()],n.prototype,\"layer\",null),e([t({readOnly:!0})],n.prototype,\"layers\",null),e([t({readOnly:!0})],n.prototype,\"layerDefs\",null),e([t({type:Number})],n.prototype,\"scale\",void 0),e([t(a)],n.prototype,\"timeExtent\",void 0),e([t({readOnly:!0})],n.prototype,\"version\",null),e([t({readOnly:!0})],n.prototype,\"visibleSublayers\",null),n=e([i(\"esri.layers.mixins.ExportImageParameters\")],n);export{n as ExportImageParameters};\n"],"sourceRoot":""}