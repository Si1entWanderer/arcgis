{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/support/FeatureFilter.js","../node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js","../node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFilterVisibility.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView.js","../node_modules/@arcgis/core/views/3d/layers/support/floorFilterUtils.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js","../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js","../node_modules/@arcgis/core/views/3d/layers/graphics/ExtentSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js"],"names":["d","m","i","esriSpatialRelIntersects","esriSpatialRelContains","esriSpatialRelCrosses","esriSpatialRelDisjoint","esriSpatialRelEnvelopeIntersects","esriSpatialRelIndexIntersects","esriSpatialRelOverlaps","esriSpatialRelTouches","esriSpatialRelWithin","esriSpatialRelRelation","u","esriSRUnit_Meter","esriSRUnit_Kilometer","esriSRUnit_Foot","esriSRUnit_StatuteMile","esriSRUnit_NauticalMile","esriSRUnit_USNauticalMile","h","e","where","geometry","spatialRelationship","hiddenIds","Set","distance","objectIds","units","timeExtent","enabled","t","this","_set","r","s","n","a","p","c","o","l","forEach","add","type","String","prototype","types","json","read","write","source","reader","target","writer","Array","from","Number","overridePolicy","readOnly","y","toLowerCase","get","name","_dataQueryEngineInstance","layer","geometryType","outSpatialReference","spatialReference","toJSON","ensureDataQueryEngine","clear","destroy","dataQueryEngine","executeQueryForIdSet","_ensureQueryJSON","executeQueryForCount","executeQueryForExtent","count","extent","fromJSON","executeQueryForIds","executeQueryForLatestObservations","features","sourceLayer","executeQuery","defaultQueryJSON","timeInfo","objectIdField","queryGeometryType","fields","map","layerView","view","resourceController","scheduler","priority","graphics3d","graphicsCore","featureStore","hasZ","hasM","constructOnly","aliasOf","getLogger","_","filter","_dirty","_querying","_handles","_queryResult","_layerView","_core","_objectIdField","_queryEngine","FILTER_VISIBILITY","registerTask","owner","_graphicsChanged","dirty","filterChanged","modifyGraphics3DGraphicVisibilities","clearVisibilityFlag","notifyChange","active","hasVisibilityFlag","setVisibilityFlag","recomputeFilter","graphics3DGraphics","size","clone","intersection","done","then","catch","warn","error","_getFeatureId","graphic","madeProgress","has","objectId","attributes","V","watchUpdatingTracking","C","suspendResumeExtentMode","dataExtent","suspendResumeExtent","scaleVisibility","suspended","outsideScaleRange","frustumVisibility","outsideOfView","updating","frustumVisibilityEnabled","f","scaleVisibilityEnabled","w","filterVisibilityEnabled","timeExtentVisibilityEnabled","elevationAlignmentEnabled","g","preferredUpdatePolicy","elevationFeatureExpressionEnabled","graphicSymbolSupported","filterVisibility","elevationAlignment","updateClippingExtent","layerMinMaxScaleChangeHandler","addPromise","elevationInfoChange","updateVisibilityInfo","updateLabelingInfo","setup","basemapTerrain","spatialIndex","queryGraphicUIDsInExtent","elevationProvider","b","labeler","addGraphicsOwner","deconflictor","deconfliction","labeling","objectStates","rendererChange","opacityChange","setupSuspendResumeExtent","_updateClippingExtent","startCreateGraphics","labelsEnabled","acquireSet","set","handle","setUid","uid","queryObjectIds","setObjectIds","highlight","toArray","isArray","length","E","fieldsIndex","setUids","S","clippingArea","setClippingExtent","recreateAllGraphics","remove","j","updateSuspendResumeExtent","watch","computedExtent","suspendResumeExtentChanged","extentToSuspendResumeRect","equals","x","extentPadding","setExtent","dependsOn","v","pause","resume","floorInfo","floors","push","floorField","join","arguments","extentIntersectionDirty","_isVisibleBelowSurface","handles","extentIntersection","renderCoordsHelper","on","viewChange","state","FRUSTUM_VISIBILITY","elevationBoundsChange","viewingMode","isVisibleBelowSurface","updateIsVisibleBelowSurface","_setDirty","ground","navigationConstraint","opaque","radius","elevationBounds","min","max","Math","update","updateExtentIntersection","frustum","isVisibleInFrustum","items","objectStateId","object","renderGeometry","_removeObjectStateItem","splice","channel","removeHighlight","removeOcclude","removeRenderGeometryObjectState","stateType","objectStateSet","ids","paused","_graphicsCore","_stateSets","removeAll","releaseSet","indexOf","addObjectStateSet","removeObjectState","_addObjectStateSet","initializeSet","hasGraphic","_removeObjectStateSet","states","_extents","allocator","_tmpExtent","contains","removeContained","pushNew","mergeTight","pop","hasProgressed","sort","getItemAt","delete","some","filterInPlace","containsPoint","dirtyExtents","globalDirty","averageExtentUpdateSize","dirtyGraphicsSet","updateElevation","events","_elevationChanged","suspendedChange","ELEVATION_ALIGNMENT","running","empty","markAllGraphicsElevationDirty","run","merge","_updateDirtyGraphics","_updateDirtyExtents","setDirty","effectiveUpdatePolicy","keys","getGraphics3DGraphicById","alignWithElevation","emit","needsElevationUpdates","context","elevationInfo","mode","xmin","xmax","ymin","ymax"],"mappings":"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","file":"static/js/5.03767f37.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{geometryTypes as t}from\"../../../geometry.js\";import r from\"../../../TimeExtent.js\";import{JSONMap as i}from\"../../../core/jsonMap.js\";import{JSONSupport as s}from\"../../../core/JSONSupport.js\";import{clone as o}from\"../../../core/lang.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{writer as p}from\"../../../core/accessorSupport/decorators/writer.js\";import{fromJSON as l}from\"../../../geometry/support/jsonUtils.js\";import c from\"../../../rest/support/Query.js\";var d;const m=new i({esriSpatialRelIntersects:\"intersects\",esriSpatialRelContains:\"contains\",esriSpatialRelCrosses:\"crosses\",esriSpatialRelDisjoint:\"disjoint\",esriSpatialRelEnvelopeIntersects:\"envelope-intersects\",esriSpatialRelIndexIntersects:\"index-intersects\",esriSpatialRelOverlaps:\"overlaps\",esriSpatialRelTouches:\"touches\",esriSpatialRelWithin:\"within\",esriSpatialRelRelation:\"relation\"}),u=new i({esriSRUnit_Meter:\"meters\",esriSRUnit_Kilometer:\"kilometers\",esriSRUnit_Foot:\"feet\",esriSRUnit_StatuteMile:\"miles\",esriSRUnit_NauticalMile:\"nautical-miles\",esriSRUnit_USNauticalMile:\"us-nautical-miles\"});let h=d=class extends s{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship=\"intersects\",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||\"1=1\"}enable(){this._set(\"enabled\",!0)}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:a,distance:p}=this;return new c({geometry:o(r),objectIds:o(n),spatialRelationship:i,timeExtent:o(s),where:t,units:a,distance:p,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,hiddenIds:i,timeExtent:s,objectIds:n,units:a,distance:p}=this,l=new Set;return i.forEach((e=>l.add(e))),new d({geometry:o(t),hiddenIds:l,objectIds:o(n),spatialRelationship:r,timeExtent:o(s),where:e,units:a,distance:p})}};e([n({type:String})],h.prototype,\"where\",void 0),e([p(\"where\")],h.prototype,\"writeWhere\",null),e([n({types:t,json:{read:l,write:!0}})],h.prototype,\"geometry\",void 0),e([n({type:String,json:{read:{source:\"spatialRel\",reader:m.read},write:{target:\"spatialRel\",writer:m.write}}})],h.prototype,\"spatialRelationship\",void 0),e([n({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],h.prototype,\"hiddenIds\",void 0),e([n({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],h.prototype,\"distance\",void 0),e([n({type:[Number],json:{write:!0}})],h.prototype,\"objectIds\",void 0),e([n({type:String,json:{read:u.read,write:{writer:u.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],h.prototype,\"units\",void 0),e([n({type:r,json:{write:!0}})],h.prototype,\"timeExtent\",void 0),e([n({readOnly:!0})],h.prototype,\"enabled\",void 0),h=d=e([a(\"esri.views.layers.support.FeatureFilter\")],h);var y=h;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction n(n,t,e){if(!e||null==t)return null;if(!n)return r(t,e);const o=n.get(e);return o?t[o.name]:null}function r(n,r){const t=r.toLowerCase();for(const e in n)if(e.toLowerCase()===t)return n[e];return null}export{n as attributeLookup};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import r from\"../../../../core/Accessor.js\";import{isNone as t}from\"../../../../core/maybe.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../../geometry/Extent.js\";import o from\"../../../../layers/graphics/data/QueryEngine.js\";import i from\"../../../../rest/support/FeatureSet.js\";import u from\"../../../../rest/support/Query.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../../geometry/support/typeUtils.js\";const c=o;let l=class extends r{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case\"multipoint\":case\"point\":case\"polygon\":case\"polyline\":return this.layer.geometryType;case\"mesh\":return\"polygon\";default:return}}get defaultQueryJSON(){return new u({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,r){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),r)}async executeQueryForCount(e,r){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:n.fromJSON(s)}}async executeQueryForIds(e,r){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQueryForLatestObservations(e,r){const t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,r){const t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return t(e)?this.defaultQueryJSON:(\"outSpatialReference\"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=\"timeInfo\"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,r=this.layer.objectIdField,t=y.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),a=this.layerView.view.resourceController.scheduler,n=this.priority,o=this.spatialReference.toJSON(),i=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:u,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new c({hasZ:u,hasM:l,geometryType:t,fields:s,timeInfo:e,spatialReference:o,objectIdField:r,featureStore:i,scheduler:a,priority:n}),this._dataQueryEngineInstance}};e([s({constructOnly:!0})],l.prototype,\"layerView\",void 0),e([s({constructOnly:!0})],l.prototype,\"priority\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.view.spatialReference\"})],l.prototype,\"spatialReference\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.layer\"})],l.prototype,\"layer\",void 0),e([s({readOnly:!0})],l.prototype,\"queryGeometryType\",null),e([s({readOnly:!0})],l.prototype,\"defaultQueryJSON\",null),l=e([a(\"esri.views.3d.layers.graphics.QueryEngine\")],l);var p=l;export default p;export{l as QueryEngine};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/Accessor.js\";import t from\"../../../../core/Handles.js\";import r from\"../../../../core/Logger.js\";import{isNone as s,isSome as h}from\"../../../../core/maybe.js\";import{isAbortError as l}from\"../../../../core/promiseUtils.js\";import{on as o}from\"../../../../core/watchUtils.js\";import{property as n}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import u from\"./QueryEngine.js\";import{getFloorFilterClause as c}from\"../support/floorFilterUtils.js\";import y from\"../../../layers/support/FeatureFilter.js\";import{TaskPriority as d}from\"../../../support/Scheduler.js\";const p=r.getLogger(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\");let _=class extends i{constructor(...e){super(...e),this.filter=null,this._dirty=!1,this._querying=!1,this._handles=new t}get updating(){return this._dirty||this._querying||null!=this._queryResult}setup(e,i){this._layerView=e,this._core=i,this._objectIdField=e.layer.objectIdField,this._queryEngine=new u({layerView:this._layerView,priority:d.FILTER_VISIBILITY});const t=this._layerView.view.resourceController.scheduler;this._handles.add(t.registerTask(d.FILTER_VISIBILITY,this)),this._handles.add(o(i.owner,\"loadedGraphics\",\"after-changes\",(e=>this._graphicsChanged(e)),(()=>this.dirty=!0))),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(2))),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange(\"updating\")}_graphicsChanged(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}filterChanged(){const e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)}get active(){return this.filter&&this._core.graphics3DGraphics.size>0}recomputeFilter(){const e=\"filter\"in this._layerView?this._layerView.filter:null,i=\"timeExtent\"in this._layerView?this._layerView.timeExtent:null,t=c(this._layerView);if(s(i)&&s(t))return e;const r=h(e)?e.clone():new y;if(h(i)&&(r.timeExtent=h(r.timeExtent)?r.timeExtent.intersection(i):i),h(t)){const e=null==r.where||\"\"===r.where;r.where=e?t:`(${r.where}) AND (${t})`}return r}get running(){return this._dirty&&!this._querying||null!=this._queryResult}runTask(e){this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((e=>{this._queryResult=e,this._querying=!1})).catch((e=>{l(e)||(p.warn(\"FeatureFilter query failed: \"+e,{error:e}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach((e=>this._queryResult.add(this._getFeatureId(e.graphic)))),this._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((i=>{if(e.done)return!1;const t=this._queryResult.has(this._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,t,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange(\"updating\")):this.clear()}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty!==e&&(this._dirty=e,this.notifyChange(\"updating\"))}};e([n({readOnly:!0})],_.prototype,\"updating\",null),_=e([a(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\")],_);export{_ as Graphics3DFilterVisibility};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Graphic.js\";import i from\"../../../../core/Accessor.js\";import{neverReached as s}from\"../../../../core/compilerUtils.js\";import r from\"../../../../core/Handles.js\";import{logOnError as n}from\"../../../../core/promiseUtils.js\";import{init as a}from\"../../../../core/watchUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{diff as p}from\"../../../../core/accessorSupport/diffUtils.js\";import{canProject as h,project as d}from\"../../../../geometry/support/webMercatorUtils.js\";import c from\"../../../../rest/support/Query.js\";import{SUSPEND_RESUME_EXTENT_OPTIMISM as u}from\"./constants.js\";import{Graphics3DCore as g}from\"./Graphics3DCore.js\";import m from\"./Graphics3DElevationAlignment.js\";import{Graphics3DFilterVisibility as y}from\"./Graphics3DFilterVisibility.js\";import f from\"./Graphics3DFrustumVisibility.js\";import{Graphics3DObjectStates as b}from\"./Graphics3DObjectStates.js\";import w from\"./Graphics3DScaleVisibility.js\";import{enlargeExtent as x}from\"./graphicUtils.js\";import{attributeLookup as E}from\"../support/attributeUtils.js\";import{WatchUpdatingTracking as C}from\"../../../support/WatchUpdatingTracking.js\";let V=class extends i{constructor(t){super(t),this._handles=new r,this.watchUpdatingTracking=new C,this.suspendResumeExtentMode=\"computed\",this.dataExtent=null,this.suspendResumeExtent=null}get suspended(){var t;return null==(t=this.scaleVisibility)?void 0:t.suspended}get suspendInfo(){var t,e;const i={};return null!=(t=this.scaleVisibility)&&t.suspended&&(i.outsideScaleRange=!0),null!=(e=this.frustumVisibility)&&e.suspended&&(i.outsideOfView=!0),i}get updating(){var t,e,i;return!!(null!=(t=this.graphicsCore)&&t.updating||null!=(e=this.frustumVisibility)&&e.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}normalizeCtorArgs(t){const e=t.frustumVisibilityEnabled?new f:null,i=t.scaleVisibilityEnabled?new w:null,s=(t.filterVisibilityEnabled||t.timeExtentVisibilityEnabled)&&\"multipatch\"!==t.layer.geometryType?new y:null,r=t.elevationAlignmentEnabled?new m:null,n=new g({owner:t.owner,layer:t.layer,preferredUpdatePolicy:t.preferredUpdatePolicy,elevationFeatureExpressionEnabled:t.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:t.owner.hasZ,hasM:t.owner.hasM}),{updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}=t;return{graphicsCore:n,frustumVisibility:e,scaleVisibility:i,filterVisibility:s,elevationAlignment:r,updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}}initialize(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,\"scaleRangeId\",(()=>this.scaleVisibility.layerMinMaxScaleChangeHandler())),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,\"filter\",(()=>this.filterVisibility.filterChanged())),this.watchUpdatingTracking.add(this.owner,\"timeExtent\",(()=>this.filterVisibility.filterChanged()))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,\"elevationInfo\",((t,e)=>{p(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,\"labelsVisible\",(()=>this.graphicsCore.updateVisibilityInfo())),this.watchUpdatingTracking.add(this.layer,\"labelingInfo\",((t,e)=>{p(t,e)&&this.graphicsCore.updateLabelingInfo()}))}async setup(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const t=this.owner,e=this.owner.view.basemapTerrain,i=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,i,this.graphicsCore,e),this.filterVisibility&&(\"filter\"in t||\"timeExtent\"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){const e=t.view.elevationProvider;this.elevationAlignment.setup(t,i,this.graphicsCore,e)}this._set(\"objectStates\",new b(this.graphicsCore)),this._set(\"labeling\",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set(\"deconfliction\",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),await n(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates})),this.watchUpdatingTracking.add(this.layer,\"renderer\",(t=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(t)))),this.watchUpdatingTracking.add(t,\"fullOpacity\",(()=>this.graphicsCore.opacityChange())),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,\"clippingArea\",(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await n(this.graphicsCore.updateLabelingInfo())}destroy(){this._handles&&(this._handles.destroy(),this._handles=null);const t=[\"watchUpdatingTracking\",\"frustumVisibility\",\"scaleVisibility\",\"filterVisibility\",\"elevationAlignment\",\"objectStates\",\"graphicsCore\"];for(const e of t){const t=this[e];t&&(t.destroy(),this._set(e,null))}this._set(\"layer\",null),this._set(\"owner\",null)}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t,i){if(t instanceof c){const{set:e,handle:s}=this.objectStates.acquireSet(0,i);return this.owner.queryObjectIds(t).then((t=>this.objectStates.setObjectIds(e,t))),s}if(\"number\"==typeof t||\"string\"==typeof t)return this.highlight([t],i);if(t instanceof e)return this.highlight([t],i);if(\"toArray\"in t&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof e){const e=t;if(null==E(this.layer.fieldsIndex,e[0].attributes,i)){const t=e.map((t=>t.uid)),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,t),s}t=e.map((t=>E(this.layer.fieldsIndex,t.attributes,i)))}if(\"number\"==typeof t[0]||\"string\"==typeof t[0]){const e=t,{set:s,handle:r}=this.objectStates.acquireSet(0,i);return this.objectStates.setObjectIds(s,e),r}}return S}_updateClippingExtent(){const t=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.owner.view.spatialReference)&&(this.updateClippingExtent(t)||this.graphicsCore.recreateAllGraphics())}setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(a(this,\"suspendResumeExtentMode\",(()=>{switch(this._handles.remove(j),this.suspendResumeExtentMode){case\"computed\":this._handles.add([a(this.graphicsCore,\"computedExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],j);break;case\"data\":this._handles.add([a(this,\"dataExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.dataExtent)))],j);break;default:s(this.suspendResumeExtentMode)}})))}updateSuspendResumeExtent(t){t?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(t,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}extentToSuspendResumeRect(t,e){const i=this.owner.view.spatialReference;if(!t.spatialReference.equals(i)){if(!h(t,i))return;t=d(t,i)}return x(t,e,u,this.graphicsCore.extentPadding)}suspendResumeExtentChanged(t){this.frustumVisibility&&this.frustumVisibility.setExtent(t),this.scaleVisibility&&this.scaleVisibility.setExtent(t)}};t([o({aliasOf:\"graphicsCore.layer\"})],V.prototype,\"layer\",void 0),t([o({aliasOf:\"graphicsCore.owner\"})],V.prototype,\"owner\",void 0),t([o({constructOnly:!0})],V.prototype,\"updateClippingExtent\",void 0),t([o({constructOnly:!0})],V.prototype,\"graphicsCore\",void 0),t([o({constructOnly:!0})],V.prototype,\"scaleVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"filterVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"elevationAlignment\",void 0),t([o({constructOnly:!0})],V.prototype,\"frustumVisibility\",void 0),t([o({readOnly:!0})],V.prototype,\"deconfliction\",void 0),t([o({readOnly:!0})],V.prototype,\"labeling\",void 0),t([o({readOnly:!0})],V.prototype,\"objectStates\",void 0),t([o({readOnly:!0})],V.prototype,\"watchUpdatingTracking\",void 0),t([o()],V.prototype,\"suspendResumeExtentMode\",void 0),t([o()],V.prototype,\"dataExtent\",void 0),t([o({readOnly:!0})],V.prototype,\"suspended\",null),t([o({readOnly:!0})],V.prototype,\"suspendInfo\",null),t([o({readOnly:!0,dependsOn:[\"graphicsCore.updating\",\"frustumVisibility.updating\",\"watchUpdatingTracking.updating\"]})],V.prototype,\"updating\",null),V=t([l(\"esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView\")],V);var v=V;const j=\"suspendResumeExtentMode\",S={remove(){},pause(){},resume(){}};export default v;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction o(o){const n=o.layer;if(\"floorInfo\"in n&&n.floorInfo){const r=o.view.floors;if(!r||!r.length)return null;const l=r.filter((o=>\"\"!==o)).map((o=>`'${o}'`));l.push(\"''\");const f=n.floorInfo.floorField;return`${f} IN (${l.join(\", \")}) OR ${f} IS NULL`}return null}export{o as getFloorFilterClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import{init as i}from\"../../../../core/watchUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{FrustumExtentIntersection as a}from\"../../support/FrustumExtentIntersection.js\";import{TaskPriority as l}from\"../../../support/Scheduler.js\";const h=1.2;let u=class extends t{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new s,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),r.registerTask(l.FRUSTUM_VISIBILITY,this),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([i(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),i(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([r({readOnly:!0})],u.prototype,\"suspended\",void 0),e([r({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);var p=u;export default p;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nclass e{constructor(){this.items=[]}addObject(e,t){this.items.push({type:0,objectStateId:t,object:e})}addRenderGeometry(e,t,s){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:s})}addExternal(e,t){this.items.push({type:2,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];s.objectStateId===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];0===s.type&&s.object===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];1===s.type&&s.renderGeometry===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeAll(){this.items.forEach((e=>{this._removeObjectStateItem(e)})),this.items=[]}_removeObjectStateItem(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}export{e as Object3DStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{Object3DStateSet as t}from\"../../webgl-engine/lib/Object3DStateSet.js\";class e{constructor(e,i){this.stateType=e,this.objectIdField=i,this.objectStateSet=new t,this.ids=new Set,this.paused=!1}hasGraphic(t){if(this.objectIdField){const e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)}}export{e as Graphics3DObjectStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../core/handleUtils.js\";import{Graphics3DObjectStateSet as e}from\"./Graphics3DObjectStateSet.js\";class s{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll())),this._stateSets=null}acquireSet(s,a){const i=new e(s,a);this._stateSets.push(i);const h=t((()=>this.releaseSet(i)));return{set:i,handle:h}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}_addObjectStateSet(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)}_removeObjectStateSet(t,e){t.removeObjectState(e.objectStateSet)}setUid(t,e){t.ids.add(e);const s=this._graphicsCore.graphics3DGraphics.get(e);s&&this._addObjectStateSet(s,t)}setUids(t,e){e.forEach((e=>this.setUid(t,e)))}setObjectIds(t,e){e.forEach((e=>t.ids.add(e))),this.initializeSet(t)}addGraphic(t){this._stateSets.forEach((e=>{!e.paused&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}))}removeGraphic(t){this._stateSets.forEach((e=>{e.hasGraphic(t)&&this._removeObjectStateSet(t,e)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll()))}initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach((e=>{e&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})):t.ids.forEach((s=>{const a=e.get(s);a&&this._addObjectStateSet(a,t)}))}get test(){return{states:this._stateSets}}}export{s as Graphics3DObjectStates};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/PooledArray.js\";import{create as e,set as r,area as s,expand as n,contains as o,containsPoint as i}from\"../../../../geometry/support/aaBoundingRect.js\";import{noBudget as h}from\"../../../support/Scheduler.js\";const a=.05;class c{constructor(){this._extents=new t({allocator:t=>t||e()}),this._tmpExtent=e(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this.contains(t)||(this.removeContained(t),r(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this.mergeTight(),this._extents.pop()}merge(t){return this.mergeTight(t),t.hasProgressed}mergeTight(t=h){const e=this._extents,o=new Set;let i=0;for(;i!==e.length;){e.sort(((t,e)=>t[0]-e[0])),i=e.length,o.clear();for(let i=0;i<e.length;++i){if(t.done)return;const h=e.getItemAt(i);for(let t=i+1;t<e.length;++t){const r=e.getItemAt(t);if(r[0]>=h[2])break;o.add(r)}o.forEach((i=>{if(h===i)return;if(i[2]<=h[0])return void o.delete(i);const c=s(h),g=s(i),m=this._tmpExtent;n(h,i,m);const d=c+g;(s(m)-d)/d<a&&(r(h,m),o.delete(i),e.remove(i),t.madeProgress())})),o.add(h)}}this._dirty=!1}contains(t){return this._extents.some((e=>o(e,t)))}removeContained(t){this._extents.filterInPlace((e=>!o(t,e)))}get test(){const t=this;return{containsPoint:e=>t._extents.some((t=>i(t,e)))}}}export{c as ExtentSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import i from\"../../../../core/Evented.js\";import s from\"../../../../core/Handles.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{ExtentSet as h}from\"./ExtentSet.js\";import{TaskPriority as o}from\"../../../support/Scheduler.js\";let p=class extends t{constructor(){super(...arguments),this.dirtyExtents=new h,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new s,this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new i}setup(e,t,i,s){this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=s;const r=this.layerView.view.resourceController.scheduler;this.handles.add([s.on(\"elevation-change\",(e=>this._elevationChanged(e))),this.layerView.watch(\"suspended\",(()=>this.suspendedChange())),r.registerTask(o.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange(\"updating\")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange(\"updating\"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange(\"updating\")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((()=>this.dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange(\"updating\")}_updateDirtyGraphics(e){const t=this.layerView.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const s of this.dirtyGraphicsSet.keys()){const a=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),r(a)&&(a.alignWithElevation(this.elevationProvider,t,i),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const t=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i});const s=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);r(t)&&t.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-s)+.9*this.averageExtentUpdateSize,e.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this.dirtyGraphicsSet.add(t)))}_elevationChanged(e){if(\"scene\"===e.context&&(!this.graphicsCore.layer.elevationInfo||\"relative-to-scene\"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:i}=e;if(this.layerView.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange(\"updating\")}};e([a({readOnly:!0})],p.prototype,\"updating\",null),e([a({readOnly:!0})],p.prototype,\"updatingRemaining\",null),p=e([n(\"esri.views.3d.layers.graphics.Graphics3DElevationAlignment\")],p);var d=p;export default d;\n"],"sourceRoot":""}