{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/analysis/DirectLineMeasurement/DirectLineMeasurementController.js","../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/MeasurementArrowTechnique.js","../node_modules/@arcgis/core/views/3d/webgl-engine/materials/MeasurementArrowMaterial.js","../node_modules/@arcgis/core/views/3d/interactive/visualElements/MeasurementArrowVisualElement.js","../node_modules/@arcgis/core/views/3d/interactive/visualElements/RightAngleQuadVisualElement.js","../node_modules/@arcgis/core/views/3d/layers/analysis/DirectLineMeasurement/DirectLineMeasurementView.js","../node_modules/@arcgis/core/views/3d/layers/DirectLineMeasurementLayerView3D.js","../node_modules/@arcgis/core/chunks/MeasurementArrow.glsl.js"],"names":["A","e","_unitNormalizer","k","_handles","s","_tempStartPosition","u","_tempEndPosition","_tempCornerPosition","this","add","l","view","_initialize","a","spatialReference","t","v","D","z","_sphericalPCPF","i","g","d","result","_computedResult","viewData","layer","startPoint","endPoint","n","_euclideanDistances","_exactGeodesicDistanceAndAngle","horizontal","value","directDistance","direct","horizontalDistance","verticalDistance","vertical","geodesicDistance","distance","geodesicAngle","angle","clone","r","o","j","m","h","p","Math","abs","normalizeDistance","f","_","y","c","addPath","isGeographic","P","b","isWebMercator","_fallbackGeodesicAngle","_fallbackGeodesicDistance","w","metersPerDegree","R","G","sin","cos","M","prototype","shader","get","build","rctx","program","camera","projectionMatrix","setUniform1f","width","outlineSize","setUniform4fv","outlineColor","stripeLength","stripeEvenColor","stripeOddColor","rebindTextures","polygonOffset","configuration","polygonOffsetEnabled","factor","units","depthTest","func","depthWrite","colorWrite","arguments","techniqueConfig","params","output","updateParameters","_technique","_techniqueRep","releaseAndAcquire","_material","getTechniqueConfig","bindPass","getPassParameters","vec3f","vec2f","f32","q","x","C","vertexBufferLayout","createBuffer","indices","length","vertexAttributes","data","console","warn","transformation","invTranspTransformation","position","L","normal","uv0","setVec","set","T","auxpos1","_parameters","_origin","_originTransform","_arrowCenter","_renderOccluded","_geometry","_stripeLength","_stripesEnabled","applyProps","_arrowMaterial","setParameterValues","renderOccluded","geometryChanged","attached","arrowStripeEvenColor","arrowStripeOddColor","arrowOutlineColor","state","watch","viewChanged","destroy","startRenderSpace","endRenderSpace","_createArrowGeometry","addGeometry","renderCoordsHelper","push","type","eval","worldUpAtPosition","arrowSubdivisions","createPolylineGeometry","recreateGeometry","ready","computeScreenPixelSizeAt","arrowWidth","arrowOutlineWidth","arrowStripeLength","_quadMaterial","_outlineMaterial","_maxSize","_position","_up","_right","_color","_outlineColor","_outlineSize","_size","_outlineRenderOccluded","_updateQuadMaterial","_updateOutlineMaterial","_updateTransform","previous","center","next","min","quadMaterialParameters","O","outlineMaterialParameters","removeAll","_createQuadGeometry","_createOutlineGeometry","_quadGeometryData","object","size","exclusive","Uint16Array","color","transparent","writeDepth","U","_params","Q","_segmentVisualElement","_triangleVisualElement","_rightAngleQuad","_projectedGeodesicLine","_geodesicStartHint","_geodesicEndHint","_segmentLabel","_verticalLabel","_horizontalLabel","_startPosition","E","_endPosition","_cornerPosition","_startPositionAtSeaLevel","_endPositionAtSeaLevel","_state","_segmentLabelDisplayedMeasurement","_triangleOrientationOverride","messages","viewMode","visualizedMeasurement","actualVisualizedMeasurement","visualElementOrientation","triangleCollapseRatioThreshold","layerView","geodesicDistanceThreshold","visible","suspended","_getActualVisualElementsOrientation","labels","Error","geometry","triangleLineWidth","triangleColor","W","stippleIntegerRepeats","geodesicProjectionLineWidth","geodesicProjectionLineColor","stipplePattern","guideStippleLengthPixels","guideLineWidth","fontSize","direcLabelFontSize","verticalLabelFontSize","horizontalLabelFontSize","S","_updateGeometryAndViewMode","_updateVisualElementVisibility","_updateLabelText","_updateLabelVisibility","_updateSegmentStripeLength","_updateMessageBundle","whenReady","equals","toRenderCoords","_updateActualVisualizedMeasurement","_computeViewMode","getAltitude","_updateSegment","_updateSegmentAndTriangle","_updateSegmentAndProjection","anchor","segment","sampleLocation","V","B","I","projectToRenderScreen","J","K","H","N","F","setAltitude","setGeometryFromSegment","text","_getLabelsText","euclideanDistance","notifyChange","unit","_measurementArrowStripeLength","stripesEnabled","_geodesicDistanceExceeded","_requiresGeodesicGuideAt","aboveGround","toUnit","then","readOnly","laserLineGlowColor","laserLineGlowWidth","laserLineGlowFalloff","laserLineInnerColor","laserLineInnerWidth","laserLineGlobalAlpha","laserLineEnabled","handleColor","handleOpacity","handleRadius","triangleCornerSize","triangleSubdivisions","guideLineColor","labelDistance","_userUnit","_defaultUnit","_analysisView","allowVisualElementsOrientationChange","testData","_analysisController","whenMessages","vertex","uniforms","attributes","varyings","code","fragment","sqrt","float","Object","freeze","__proto__"],"mappings":"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","file":"static/js/90.7f0922fa.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import t from\"../../../../../core/Accessor.js\";import s from\"../../../../../core/Handles.js\";import{rad2deg as i,acosClamped as r,deg2rad as o}from\"../../../../../core/mathUtils.js\";import{destroyMaybe as a,isNone as n}from\"../../../../../core/maybe.js\";import c from\"../../../../../core/Quantity.js\";import{whenOnce as l}from\"../../../../../core/watchUtils.js\";import{property as m}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as p}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{reactionInit as d}from\"../../../../../core/accessorSupport/trackingUtils.js\";import{i as h}from\"../../../../../chunks/vec3.js\";import{c as u}from\"../../../../../chunks/vec3f64.js\";import{geodesicLength as f}from\"../../../../../geometry/geometryEngine.js\";import _ from\"../../../../../geometry/Polyline.js\";import{canProjectWithoutEngine as g,projectPointToVector as j,projectPointToWGS84ComparableLonLat as y}from\"../../../../../geometry/projection.js\";import{getSphericalPCPF as v,getReferenceEllipsoid as w,SphericalECEFSpatialReference as D,WGS84ECEFSpatialReference as z}from\"../../../../../geometry/projectionEllipsoid.js\";import{isSupported as P,geodesicLengths as b,inverseGeodeticSolver as M}from\"../../../../../geometry/support/geodesicUtils.js\";import{UnitNormalizer as k}from\"../support/UnitNormalizer.js\";let A=class extends t{constructor(e){super(e),this._unitNormalizer=new k,this._handles=new s,this._tempStartPosition=u(),this._tempEndPosition=u(),this._tempCornerPosition=u()}initialize(){this._handles.add(l(this.view,\"ready\",(()=>this._initialize()),!0))}destroy(){this._handles=a(this._handles)}_initialize(){const e=this.view.spatialReference,t=v(e),s=t===D?z:t;this._sphericalPCPF=s;const i=g(e,s);this._unitNormalizer.spatialReference=i?s:e,this._handles.add(d((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e})))}get _computedResult(){const{startPoint:e,endPoint:t}=this.layer;if(n(e)||n(t))return null;const s=this._euclideanDistances(e,t),i=this._exactGeodesicDistanceAndAngle(e,t,s.horizontal.value);return{directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:i.distance,geodesicAngle:i.angle}}_euclideanDistances(e,t){const s=e.clone();s.z=t.z;const i=this._tempStartPosition,r=this._tempEndPosition,o=this._tempCornerPosition,a=this.view.spatialReference,n=this._sphericalPCPF,l=g(a,n)?n:a;j(e,i,l),j(t,r,l),j(s,o,l);const m=h(i,r),p=h(o,r),d=Math.abs(t.z-e.z),u=e=>this._unitNormalizer.normalizeDistance(e),f=u(m),_=u(p),y=u(d);return{direct:new c(f,\"meters\"),horizontal:new c(_,\"meters\"),vertical:new c(y,\"meters\")}}_exactGeodesicDistanceAndAngle(e,t,s){const i=e.spatialReference,r=new _({spatialReference:i});r.addPath([e,t]);const o=i.isGeographic&&P(i)?b([r],\"meters\")[0]:i.isWebMercator?f(r,\"meters\"):void 0,{distance:a,angle:n}=o?{distance:o,angle:this._fallbackGeodesicAngle(o,i)}:this._fallbackGeodesicDistance(e,t,s);return{distance:new c(a,\"meters\"),angle:new c(n,\"degrees\")}}_fallbackGeodesicAngle(e,t){return e/w(t).metersPerDegree}_fallbackGeodesicDistance(e,t,s){if(y(e,R)){y(t,G);const e=o(R[0]),s=o(R[1]),a=o(G[0]),n=o(G[1]),c=Math.abs(a-e),l=r(Math.sin(s)*Math.sin(n)+Math.cos(s)*Math.cos(n)*Math.cos(c)),m=i(l),p={distance:0};return M(p,[R[0],R[1]],[G[0],G[1]]),{distance:p.distance,angle:m}}const a=e.spatialReference,n=s;return{distance:n,angle:this._fallbackGeodesicAngle(n,a)}}};e([m()],A.prototype,\"view\",void 0),e([m()],A.prototype,\"layer\",void 0),e([m()],A.prototype,\"viewData\",void 0),e([m()],A.prototype,\"_computedResult\",null),A=e([p(\"esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController\")],A);const R=u(),G=u();export{A as DirectLineMeasurementController};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../../chunks/tslib.es6.js\";import{bindProjectionMatrix as e,bindView as o}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as t}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as i}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as s,parameter as n}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as a}from\"../lib/DefaultVertexAttributeLocations.js\";import{Program as m}from\"../lib/Program.js\";import{M as p}from\"../../../../chunks/MeasurementArrow.glsl.js\";import{makePipelineState as l,defaultDepthWriteParams as f,defaultColorWriteParams as h}from\"../../../webgl/renderState.js\";class d extends i{constructor(r,e,o){super(r,e,o)}initializeProgram(r){const e=d.shader.get().build();return new m(r.rctx,e,a)}bindPass(r,o){e(this.program,o.camera.projectionMatrix),this.program.setUniform1f(\"width\",r.width),this.program.setUniform1f(\"outlineSize\",r.outlineSize),this.program.setUniform4fv(\"outlineColor\",r.outlineColor),this.program.setUniform1f(\"stripeLength\",r.stripeLength),this.program.setUniform4fv(\"stripeEvenColor\",r.stripeEvenColor),this.program.setUniform4fv(\"stripeOddColor\",r.stripeOddColor)}bindDraw(r){o(this.program,r),this.program.rebindTextures()}initializePipeline(){return l({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:f,colorWrite:h})}get primitiveType(){return 5}}d.shader=new t(p,(()=>import(\"./MeasurementArrow.glsl.js\")));class u extends s{constructor(){super(...arguments),this.polygonOffsetEnabled=!1}}r([n()],u.prototype,\"polygonOffsetEnabled\",void 0);export{d as MeasurementArrowTechnique,u as MeasurementArrowTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{s as e,n as t,f as s,c as r,i,m as o}from\"../../../../chunks/vec3.js\";import{c as n}from\"../../../../chunks/vec3f64.js\";import{newLayout as a}from\"../../support/buffer/InterleavedLayout.js\";import c from\"../lib/GLMaterial.js\";import{Material as u,materialParametersDefaults as f}from\"../lib/Material.js\";import{MeasurementArrowTechniqueConfiguration as l,MeasurementArrowTechnique as p}from\"../shaders/MeasurementArrowTechnique.js\";class h extends u{constructor(e){super(e,d),this.techniqueConfig=new l}getTechniqueConfig(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}dispose(){}getPassParameters(){return this.params}intersect(){}createBufferWriter(){return new w}getGLMaterial(e){return 0===e.output?new m(e):void 0}}class m extends c{constructor(e){super(e),this.updateParameters()}updateParameters(){this._technique=this._techniqueRep.releaseAndAcquire(p,this._material.getTechniqueConfig(),this._technique)}beginSlot(e){return 3===e}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const d={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...f},g=a().vec3f(\"position\").vec3f(\"normal\").vec2f(\"uv0\").f32(\"auxpos1\"),v=n(),q=n(),b=n(),x=n(),C=n();class w{constructor(){this.vertexBufferLayout=g}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get(\"position\").length/2+1)}write(n,a,c,u){const f=a.vertexAttributes.get(\"position\").data,l=a.vertexAttributes.get(\"normal\").data,p=f.length/3,h=a&&a.indices&&a.indices.get(\"position\");h&&h.length!==2*(p-1)&&console.warn(\"MeasurementArrowMaterial does not support indices\");const m=v,d=q,g=b,w=x,P=C,j=n.transformation,y=n.invTranspTransformation,A=c.position,L=c.normal,M=c.uv0;let _=0;for(let v=0;v<p;++v){const n=3*v;if(e(m,f[n],f[n+1],f[n+2]),v<p-1){const i=3*(v+1);e(d,f[i],f[i+1],f[i+2]),e(P,l[i],l[i+1],l[i+2]),t(P,P),s(g,d,m),t(g,g),r(w,P,g),t(w,w)}const a=i(m,d);j&&y&&(o(m,m,j),o(d,d,j),o(w,w,y));const c=u+2*v,h=c+1;A.setVec(c,m),A.setVec(h,m),L.setVec(c,w),L.setVec(h,w),M.set(c,0,_),M.set(c,1,-1),M.set(h,0,_),M.set(h,1,1),v<p-1&&(_+=a)}const T=c.auxpos1;for(let e=0;e<2*p;++e)T.set(u+e,_)}}export{h as MeasurementArrowMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Handles.js\";import{isNone as r,isSome as t}from\"../../../../core/maybe.js\";import{c as s}from\"../../../../chunks/mat4f64.js\";import{f as i}from\"../../../../chunks/vec3.js\";import{c as a}from\"../../../../chunks/vec3f64.js\";import{sv3d as o}from\"../../../../geometry/support/vectorStacks.js\";import{Object3DVisualElement as n}from\"./Object3DVisualElement.js\";import h from\"../../webgl-engine/lib/GeometryUtil.js\";import{MeasurementArrowMaterial as l}from\"../../webgl-engine/materials/MeasurementArrowMaterial.js\";class d extends n{constructor(e){super(e),this._parameters=c,this._handles=null,this._origin=a(),this._originTransform=s(),this._arrowCenter=a(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:e})}}createExternalResources(){const r=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new l({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:r,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new e,this._handles.add(this.view.state.watch(\"camera\",(()=>{this.viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(r(this._geometry)||r(this._geometry.startRenderSpace)||r(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}_createArrowGeometry(e,r,t,s){const a=this.view.renderCoordsHelper,n=[],l=[],d=(e,r)=>{const s=o.get();i(s,e,t),n.push(s),l.push(r)};if(\"euclidean\"===s.type){s.eval(.5,this._arrowCenter);const t=o.get();a.worldUpAtPosition(this._arrowCenter,t),d(e,t),d(r,t)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let r=0;r<e;++r){const t=r/(e-1),i=o.get(),n=o.get();s.eval(t,i),a.worldUpAtPosition(i,n),d(i,n)}}return h.createPolylineGeometry(n,l)}geometryChanged(){this.recreateGeometry()}viewChanged(){if(this.view.ready&&this.attached&&t(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}const c={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};export{d as MeasurementArrowVisualElement};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Handles.js\";import{isSome as t}from\"../../../../core/maybe.js\";import{i,t as r,s}from\"../../../../chunks/mat4.js\";import{c as a}from\"../../../../chunks/mat4f64.js\";import{i as o,n as l,f as n,g as u,b as h}from\"../../../../chunks/vec3.js\";import{c as d}from\"../../../../chunks/vec3f64.js\";import{c}from\"../../../../chunks/vec4.js\";import{f as _}from\"../../../../chunks/vec4f32.js\";import{sv3d as m}from\"../../../../geometry/support/vectorStacks.js\";import{Object3DVisualElement as p}from\"./Object3DVisualElement.js\";import{Geometry as M}from\"../../webgl-engine/lib/Geometry.js\";import f from\"../../webgl-engine/lib/GeometryUtil.js\";import{ColorMaterial as g}from\"../../webgl-engine/materials/ColorMaterial.js\";import{RibbonLineMaterial as O}from\"../../webgl-engine/materials/RibbonLineMaterial.js\";class y extends p{constructor(t){super(t),this._handles=new e,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=d(),this._up=d(),this._right=d(),this._renderOccluded=4,this._color=_(1,0,0,1),this._outlineColor=_(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){c(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){c(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(o(t,e),o(t,i))/3,l(this._up,n(this._up,e,t)),l(this._right,n(this._right,i,t)),u(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new g(this.quadMaterialParameters),this._outlineMaterial=new O(this.outlineMaterialParameters),this._handles.add(this.view.state.watch(\"camera\",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=h(m.get(),this._up,this._right),i=f.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const a=this.view.state.camera,o=this._size*a.computeScreenPixelSizeAt(this._position),l=Math.min(this._maxSize,o);i(z),r(z,z,this._position),s(z,z,[l,l,l]),t(e)&&(e.transformation=z)}_quadGeometryData(e,t){const i=h(m.get(),e,t);return new M([[\"position\",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[\"position\",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const z=a();export{y as RightAngleQuadVisualElement};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import\"../../../../../intl.js\";import t from\"../../../../../core/Accessor.js\";import i from\"../../../../../core/Handles.js\";import{nextHighestPowerOfTen as s,sign as n,deg2rad as r}from\"../../../../../core/mathUtils.js\";import{isSome as a,isNone as o,destroyMaybe as l}from\"../../../../../core/maybe.js\";import{formatDecimal as h,formatDMS as c,formatImperialLength as d,formatImperialVerticalLength as u,formatMetricLength as m,formatMetricVerticalLength as g}from\"../../../../../core/quantityFormatUtils.js\";import{createRenderScreenPointArray3 as p,createRenderScreenPointArray as _}from\"../../../../../core/screenUtils.js\";import{preferredImperialLengthUnit as v,convertUnit as b}from\"../../../../../core/unitUtils.js\";import{whenOnce as L}from\"../../../../../core/watchUtils.js\";import{property as w}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/Logger.js\";import{subclass as y}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{autorun as S}from\"../../../../../core/accessorSupport/trackingUtils.js\";import{h as f}from\"../../../../../chunks/vec2.js\";import{a as z,b as V}from\"../../../../../chunks/vec3.js\";import{c as E}from\"../../../../../chunks/vec3f64.js\";import{f as j}from\"../../../../../chunks/vec4f32.js\";import{getReferenceEllipsoid as P}from\"../../../../../geometry/projectionEllipsoid.js\";import{LabelVisualElement as D,mirrorPosition as A}from\"../../../interactive/visualElements/LabelVisualElement.js\";import{LineVisualElement as M}from\"../../../interactive/visualElements/LineVisualElement.js\";import{MeasurementArrowVisualElement as O}from\"../../../interactive/visualElements/MeasurementArrowVisualElement.js\";import{RightAngleQuadVisualElement as C}from\"../../../interactive/visualElements/RightAngleQuadVisualElement.js\";import{GeodesicSegment as x,EuclideanSegment as G}from\"../../../interactive/visualElements/support/Segment.js\";import{screenSpaceTangent as H}from\"../support/viewUtils.js\";import{createStipplePatternSimple as k}from\"../../../webgl-engine/materials/lineStippleUtils.js\";import{onLocaleChange as R}from\"../../../../../intl/locale.js\";import{fetchMessageBundle as T}from\"../../../../../intl/messages.js\";let U=class extends t{constructor(e){super(e),this._params={...Q},this._handles=new i,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=E(),this._endPosition=E(),this._cornerPosition=E(),this._startPositionAtSeaLevel=E(),this._endPositionAtSeaLevel=E(),this._state=0,this._segmentLabelDisplayedMeasurement=1,this._triangleOrientationOverride=null,this.messages=null,this.viewMode=0,this.visualizedMeasurement=0,this.actualVisualizedMeasurement=1,this.visualElementOrientation=0,this.triangleCollapseRatioThreshold=.03}get _geodesicDistanceExceeded(){var e;const t=this.layerView.result;return a(t)&&(null==(e=t.horizontalDistance)?void 0:e.value)>this.layer.geodesicDistanceThreshold}get ready(){return 1===this._state}get visible(){return this.layerView.visible&&!this.layerView.suspended}get allowVisualElementsOrientationChange(){return o(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){o(this._triangleOrientationOverride)!==e&&(o(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._getActualVisualElementsOrientation():this._triangleOrientationOverride=null)}get labels(){return 2===this.actualVisualizedMeasurement?{direct:this._horizontalLabel,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement.stripeLength}}initialize(){this._handles.add(L(this.view,\"ready\",(()=>this._initialize()),!0))}_initialize(){switch(this._state){case 1:throw new Error(\"invalid state\");case 2:return}const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new O({...t,geometry:null,renderOccluded:4}),this._triangleVisualElement=new M({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:4}),this._rightAngleQuad=new C({...t,color:W,renderOccluded:4});const i={...t,polygonOffset:!0,stippleIntegerRepeats:!1,renderOccluded:4};this._projectedGeodesicLine=new M({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:k(e.guideStippleLengthPixels)}),this._geodesicStartHint=new M({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:k(e.guideStippleLengthPixels)}),this._geodesicEndHint=new M({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:k(e.guideStippleLengthPixels)}),this._segmentLabel=new D({...t,fontSize:e.direcLabelFontSize}),this._verticalLabel=new D({...t,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new D({...t,fontSize:e.horizontalLabelFontSize}),this._handles.add([S((()=>this._updateGeometryAndViewMode())),S((()=>this._updateVisualElementVisibility())),S((()=>this._updateLabelText())),S((()=>this._updateLabelVisibility())),S((()=>this._updateSegmentStripeLength())),R((async()=>this._updateMessageBundle()))]),this._state=1,this._updateMessageBundle()}destroy(){2!==this._state&&(this._handles=l(this._handles),this._segmentVisualElement=l(this._segmentVisualElement),this._triangleVisualElement=l(this._triangleVisualElement),this._rightAngleQuad=l(this._rightAngleQuad),this._projectedGeodesicLine=l(this._projectedGeodesicLine),this._geodesicStartHint=l(this._geodesicStartHint),this._geodesicEndHint=l(this._geodesicEndHint),this._segmentLabel=l(this._segmentLabel),this._verticalLabel=l(this._verticalLabel),this._horizontalLabel=l(this._horizontalLabel),this.set(\"view\",null),this._state=2)}async whenReady(){await L(this,\"ready\")}async whenMessages(){await this.whenReady(),await L(this,\"messages\")}_updateVisualElementVisibility(){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,this.visible)switch(this.viewMode){case 0:break;case 1:this._segmentVisualElement.visible=!0;break;case 2:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case 3:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode(){const e=this.view.renderCoordsHelper,{startPoint:t,endPoint:i}=this.layer;if(o(t)||o(i)||t.equals(i)){this.viewMode=0;const e=this.visualizedMeasurement,t=0===e;return void(this.actualVisualizedMeasurement=t?1:e)}e.toRenderCoords(t,this._startPosition),e.toRenderCoords(i,this._endPosition);const s=this._getActualVisualElementsOrientation(),n=this._updateActualVisualizedMeasurement();this.viewMode=this._computeViewMode(n);let r=this._startPosition,a=this._endPosition;const l=1===s?1:-1,h=l*(e.getAltitude(a)-e.getAltitude(r));h<0&&(r=this._endPosition,a=this._startPosition);const c=2===n?new x(this._startPosition,this._endPosition,e.spatialReference):new G(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=c,this._updateSegmentStripeLength(),this._segmentLabelDisplayedMeasurement=n,this.viewMode){case 1:this._updateSegment(c,s);break;case 2:this._updateSegmentAndTriangle(c,s,r,a,l,h);break;case 3:this._updateSegmentAndProjection(s)}}_updateSegment(e,t){this._segmentLabel.anchor=1===t?\"top\":\"bottom\",this._segmentLabel.geometry={type:\"segment\",segment:e,sampleLocation:\"center\"}}_updateSegmentAndTriangle(e,t,i,s,n,r){const a=this.view,o=a.renderCoordsHelper,l=a.state.camera,h=this._cornerPosition;o.worldUpAtPosition(i,h),z(h,h,n*Math.abs(r)),V(h,h,i),this._triangleVisualElement.geometry=[[[i[0],i[1],i[2]],[h[0],h[1],h[2]],[s[0],s[1],s[2]]]],this._rightAngleQuad.geometry={previous:i,center:h,next:s};const c=new G(i,h),d=new G(h,s),u=F(i,s,h,t,l);this._segmentLabel.anchor=u.segment,this._segmentLabel.geometry={type:\"segment\",segment:e,sampleLocation:\"center\"},this._verticalLabel.geometry={type:\"segment\",segment:c,sampleLocation:\"center\"},this._verticalLabel.anchor=u.vertical,this._horizontalLabel.geometry={type:\"segment\",segment:d,sampleLocation:\"center\"},this._horizontalLabel.anchor=u.horizontal}_updateSegmentAndProjection(e){const t=this.view.renderCoordsHelper;t.setAltitude(this._startPositionAtSeaLevel,0,this._startPosition),t.setAltitude(this._endPositionAtSeaLevel,0,this._endPosition);const i=new x(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(i),this._geodesicStartHint.setGeometryFromSegment(new G(this._startPositionAtSeaLevel,this._startPosition)),this._geodesicEndHint.setGeometryFromSegment(new G(this._endPositionAtSeaLevel,this._endPosition)),this._segmentLabel.geometry={type:\"segment\",segment:i,sampleLocation:\"center\"},this._segmentLabel.anchor=1===e?\"top\":\"bottom\"}_updateLabelText(){if(1!==this._state)return;const e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel,s=this.messages,n=this.layerView.result;if(o(n)||o(s))return e.text=null,t.text=null,void(i.text=null);const r=this._getLabelsText(s,n),a=1===this._segmentLabelDisplayedMeasurement;e.text=a?r.euclideanDistance:r.geodesicDistance,t.text=r.horizontalDistance,i.text=r.verticalDistance,this.notifyChange(\"labels\")}_updateLabelVisibility(){if(1!==this._state)return;const e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel;if(e.visible=!1,t.visible=!1,i.visible=!1,this.visible)switch(this.viewMode){case 1:e.visible=!0;break;case 2:e.visible=!0,t.visible=!0,i.visible=!0;break;case 3:e.visible=!0}}_getLabelsText(e,{directDistance:t,horizontalDistance:i,verticalDistance:s,geodesicDistance:n,geodesicAngle:r}){const a=this.layerView.unit,o=e=>({euclideanDistance:\"\",geodesicDistance:\"\",horizontalDistance:\"\",verticalDistance:\"\",...e});switch(a){case\"metric\":return o({euclideanDistance:t&&m(e,t),geodesicDistance:n&&m(e,n),horizontalDistance:i&&m(e,i),verticalDistance:s&&g(e,s)});case\"imperial\":return o({euclideanDistance:t&&d(e,t),geodesicDistance:n&&d(e,n),horizontalDistance:i&&d(e,i),verticalDistance:s&&u(e,s)});case\"degrees\":{const t=r&&h(e,r,\"degrees\");return o({euclideanDistance:t,geodesicDistance:t,horizontalDistance:t})}case\"degrees-minutes-seconds\":return o({horizontalDistance:r&&c(r)});default:return o({euclideanDistance:t&&h(e,t,a),geodesicDistance:n&&h(e,n,a),horizontalDistance:i&&h(e,i,a),verticalDistance:s&&h(e,s,a)})}}_updateSegmentStripeLength(){const e=this._measurementArrowStripeLength,t=this._segmentVisualElement;a(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}_computeViewMode(e){if(2===e){if(!this._geodesicDistanceExceeded)return 1;if(this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition))return 3}const t=this.layerView.result;if(o(t))return 1;const{verticalDistance:i,horizontalDistance:s}=t,n=i.value,r=s.value;return Math.min(n/r,r/n)<this.triangleCollapseRatioThreshold?1:2}_getActualVisualElementsOrientation(){if(a(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return 0===e?this.view.state.camera.aboveGround?1:2:e}_updateActualVisualizedMeasurement(){if(0===this.visualizedMeasurement){this.actualVisualizedMeasurement=1;const e=this.layerView.unit;\"degrees\"!==e&&\"degrees-minutes-seconds\"!==e||(this.actualVisualizedMeasurement=2),this._geodesicDistanceExceeded&&(this.actualVisualizedMeasurement=2)}else this.actualVisualizedMeasurement=this.visualizedMeasurement;return this.actualVisualizedMeasurement}_requiresGeodesicGuideAt(e){const t=this.view;if(!t.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,n=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/n>=10}get _measurementArrowStripeLength(){const e=this.view,{result:t,unit:i}=this.layerView;let n=null;if(a(t)){const e=t.directDistance;switch(i){case\"metric\":n=e&&e.toUnit(\"meters\");break;case\"imperial\":n=e&&e.toUnit(v(e.value,e.unit));break;case\"degrees\":case\"degrees-minutes-seconds\":{const e=t.geodesicAngle;n=e&&e.toUnit(\"degrees\");break}default:n=e&&e.toUnit(i)}}if(n){let t=1;return t=s(n.value/30),t*=\"degrees\"===n.unit?P(e.spatialReference).metersPerDegree:b(1,n.unit,\"meters\"),t}return null}_updateMessageBundle(){T(\"esri/core/t9n/Units\").then((e=>{this.messages=e,this.view&&this._updateLabelText()}))}};function F(e,t,i,s,r){const a=B,o=I;r.projectToRenderScreen(i,a),r.projectToRenderScreen(t,o);const l={segment:\"bottom\",horizontal:\"top\",vertical:a[0]<o[0]?\"left\":\"right\"};{const s=J,a=K;if(H(e,i,s,r),H(e,t,a,r),f(s,a)>=q){const e=n(s[1])===n(a[1]);l.segment=e?A(l.vertical):l.vertical}else{const e=N;H(i,t,e,r),f(e,a)>=q&&(l.segment=n(e[0])===n(a[0])?A(l.horizontal):l.horizontal)}}if(2===s){const e=e=>\"top\"===e?\"bottom\":\"top\";l.segment=e(l.segment),l.horizontal=e(l.horizontal),l.vertical=e(l.vertical)}return l}e([w()],U.prototype,\"_state\",void 0),e([w()],U.prototype,\"_segmentLabelDisplayedMeasurement\",void 0),e([w()],U.prototype,\"_triangleOrientationOverride\",void 0),e([w()],U.prototype,\"_geodesicDistanceExceeded\",null),e([w()],U.prototype,\"messages\",void 0),e([w()],U.prototype,\"view\",void 0),e([w()],U.prototype,\"layer\",void 0),e([w()],U.prototype,\"layerView\",void 0),e([w({readOnly:!0})],U.prototype,\"ready\",null),e([w({readOnly:!0})],U.prototype,\"visible\",null),e([w()],U.prototype,\"viewMode\",void 0),e([w()],U.prototype,\"visualizedMeasurement\",void 0),e([w()],U.prototype,\"actualVisualizedMeasurement\",void 0),e([w()],U.prototype,\"visualElementOrientation\",void 0),e([w()],U.prototype,\"triangleCollapseRatioThreshold\",void 0),e([w()],U.prototype,\"allowVisualElementsOrientationChange\",null),e([w()],U.prototype,\"labels\",null),e([w()],U.prototype,\"testData\",null),e([w()],U.prototype,\"_measurementArrowStripeLength\",null),U=e([y(\"esri.views.3d.layers.DirectLineMeasurement.DirectLineMeasurementView\")],U);const W=j(1,.5,0,.75),Q={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:W,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:W,guideLineWidth:2,guideLineColor:W,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},q=Math.cos(r(12)),B=p(),I=p(),J=_(),K=_(),N=_();export{U as DirectLineMeasurementView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{unwrapOr as t,destroyMaybe as i}from\"../../../core/maybe.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{defaultUnitPropertyMetadata as r}from\"../../../properties/defaultUnit.js\";import{LayerView3D as l}from\"./LayerView3D.js\";import{DirectLineMeasurementController as n}from\"./analysis/DirectLineMeasurement/DirectLineMeasurementController.js\";import{DirectLineMeasurementView as o}from\"./analysis/DirectLineMeasurement/DirectLineMeasurementView.js\";import u from\"../../layers/LayerView.js\";let p=class extends(l(u)){constructor(e){super(e),this._userUnit=null,this.type=\"direct-line-measurement-3d\",this.result=null}set unit(e){this._userUnit=e}get unit(){return t(this._userUnit,this._defaultUnit)}get viewMode(){return this._analysisView.viewMode}get visualizedMeasurement(){return this._analysisView.visualizedMeasurement}set visualizedMeasurement(e){this._analysisView.visualizedMeasurement=e}get actualVisualizedMeasurement(){return this._analysisView.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisView.visualElementOrientation}set visualElementOrientation(e){this._analysisView.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisView.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisView.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisView.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisView.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisView.labels.direct.text}get horizontalLabelText(){return this._analysisView.labels.horizontal.text}get verticalLabelText(){return this._analysisView.labels.vertical.text}get testData(){return this._analysisView.testData}initialize(){const e=this.view,t=this.layer;this._analysisView=new o({view:e,layer:t,layerView:this}),this._analysisController=new n({view:e,layer:t,viewData:this})}destroy(){i(this._analysisController),i(this._analysisView)}whenReady(){return this._analysisView.whenReady()}whenMessages(){return this._analysisView.whenMessages()}};e([s(r)],p.prototype,\"_defaultUnit\",void 0),e([s()],p.prototype,\"_userUnit\",void 0),e([s()],p.prototype,\"_analysisView\",void 0),e([s()],p.prototype,\"_analysisController\",void 0),e([s()],p.prototype,\"type\",void 0),e([s()],p.prototype,\"unit\",null),e([s()],p.prototype,\"layer\",void 0),e([s()],p.prototype,\"result\",void 0),e([s({readOnly:!0})],p.prototype,\"viewMode\",null),e([s()],p.prototype,\"visualizedMeasurement\",null),e([s({readOnly:!0})],p.prototype,\"actualVisualizedMeasurement\",null),e([s()],p.prototype,\"visualElementOrientation\",null),e([s()],p.prototype,\"allowVisualElementsOrientationChange\",null),e([s()],p.prototype,\"triangleCollapseRatioThreshold\",null),e([s({readOnly:!0})],p.prototype,\"directLabelText\",null),e([s({readOnly:!0})],p.prototype,\"horizontalLabelText\",null),e([s({readOnly:!0})],p.prototype,\"verticalLabelText\",null),e([s()],p.prototype,\"testData\",null),p=e([a(\"esri.views.3d.layers.DirectLineMeasurementLayerView3D\")],p);var y=p;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as t}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function o(){const o=new t;o.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\").add(\"width\",\"float\"),o.attributes.add(\"position\",\"vec3\"),o.attributes.add(\"normal\",\"vec3\"),o.attributes.add(\"uv0\",\"vec2\"),o.attributes.add(\"auxpos1\",\"float\"),o.varyings.add(\"vtc\",\"vec2\"),o.varyings.add(\"vlength\",\"float\"),o.varyings.add(\"vradius\",\"float\"),o.vertex.code.add(e`void main(void) {\nvec3 bitangent = normal;\nvtc = uv0;\nvlength = auxpos1;\nvradius = 0.5 * width;\nvec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\ngl_Position = proj * pos;\n}`),o.fragment.uniforms.add(\"outlineSize\",\"float\").add(\"outlineColor\",\"vec4\").add(\"stripeLength\",\"float\").add(\"stripeEvenColor\",\"vec4\").add(\"stripeOddColor\",\"vec4\");const r=1/Math.sqrt(2);return o.fragment.code.add(e`\n    const float INV_SQRT2 = ${e.float(r)};\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      } else if (d < outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n      vec4 color = arrowColor(ntc, vlength / vradius);\n      if (color.a == 0.0) {\n        discard;\n      }\n      gl_FragColor = color;\n    }\n  `),o}var r=Object.freeze({__proto__:null,build:o});export{r as M,o as b};\n"],"sourceRoot":""}